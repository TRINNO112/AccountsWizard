<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ACCOUNTS WIZARD DX - ARCADE EDITION</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
  
  /* ═══════════════════════════════════════════════════════════════ */
  /* ROOT VARIABLES */
  /* ═══════════════════════════════════════════════════════════════ */
  :root {
    --color-green: #00ff00;
    --color-dark-green: #003300;
    --color-cyan: #00ffff;
    --color-dark-cyan: #003344;
    --color-magenta: #ff00ff;
    --color-dark-magenta: #440022;
    --color-yellow: #ffb700;
    --color-dark-yellow: #443300;
    --color-red: #ff006e;
    --color-dark-red: #440022;
    --color-blue: #00b4d8;
    --color-dark-blue: #003344;
    --color-bg: #0a0a0a;
    --color-primary: #1a1a2e;
    --color-secondary: #0f0f23;
    --color-purple: #9d4edd;
    --color-orange: #ff6d00;
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* BASE STYLING */
  /* ═══════════════════════════════════════════════════════════════ */
  * {
    image-rendering: pixelated;
    image-rendering: -moz-crisp-edges;
    image-rendering: crisp-edges;
    box-sizing: border-box;
  }

  body {
    background: var(--color-bg);
    color: var(--color-green);
    font-family: 'Press Start 2P', monospace;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    cursor: none;
  }

  html, body {
    overflow: hidden; /* Prevent body scroll */
    height: 100%;
    width: 100%;
  }

  /* Custom Cursor */
  #custom-cursor {
    position: fixed;
    width: 20px;
    height: 20px;
    border: 2px solid var(--color-cyan);
    background: rgba(0, 255, 255, 0.2);
    pointer-events: none;
    z-index: 9999;
    transform: translate(-50%, -50%);
    transition: all 0.05s ease;
    display: none;
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* CRT SCREEN EFFECT */
  /* ═══════════════════════════════════════════════════════════════ */
  #crt-screen {
    position: relative;
    width: 100%;
    max-width: 1280px;
    height: 100vh; /* Fixed height */
    margin: auto;
    padding: 0;
    background: linear-gradient(180deg, var(--color-primary) 0%, var(--color-secondary) 100%);
    border-left: 4px solid var(--color-green);
    border-right: 4px solid var(--color-green);
    box-shadow: 
        0 0 60px rgba(0, 255, 0, 0.4),
        inset 0 0 30px rgba(0, 255, 0, 0.05);
    transition: transform 0.1s;
    overflow: hidden; /* Prevent crt scroll */
  }

  /* Scanlines */
  #crt-screen::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
      repeating-linear-gradient(
        0deg,
        rgba(0,0,0,0) 0,
        rgba(0,0,0,0) 2px,
        rgba(0, 255, 0, 0.03) 2px,
        rgba(0, 255, 0, 0.03) 4px
      );
    pointer-events: none;
    z-index: 101;
    animation: scanline 8s linear infinite;
  }

  @keyframes scanline {
    0% { transform: translateY(0); }
    100% { transform: translateY(10px); }
  }

  /* Vignette */
  #crt-screen::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, transparent 50%, rgba(0,0,0,0.7) 100%);
    pointer-events: none;
    z-index: 102;
  }

  /* Screen Shake */
  @keyframes screenShake {
    0%, 100% { transform: translate(0, 0); }
    10% { transform: translate(-4px, 4px); }
    20% { transform: translate(4px, -4px); }
    30% { transform: translate(-4px, -4px); }
    40% { transform: translate(4px, 4px); }
    50% { transform: translate(-4px, 4px); }
    60% { transform: translate(4px, -4px); }
    70% { transform: translate(-4px, -4px); }
    80% { transform: translate(4px, 4px); }
    90% { transform: translate(-4px, -4px); }
  }

  #crt-screen.shake {
    animation: screenShake 0.5s;
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* LOGO - NEW IMPROVED DESIGN */
  /* ═══════════════════════════════════════════════════════════════ */
  .main-logo {
    text-align: center;
    margin: 40px 0;
  }

  .logo-title {
    font-size: clamp(20px, 5vw, 48px);
    color: var(--color-green);
    text-shadow: 
      0 0 10px var(--color-green),
      0 0 20px var(--color-green),
      0 0 30px var(--color-green),
      0 0 40px rgba(0, 255, 0, 0.5);
    letter-spacing: 4px;
    margin: 0;
    animation: logoGlow 2s ease-in-out infinite;
    line-height: 1.2;
  }

  @keyframes logoGlow {
    0%, 100% { 
      text-shadow: 
        0 0 10px var(--color-green),
        0 0 20px var(--color-green),
        0 0 30px var(--color-green);
    }
    50% { 
      text-shadow: 
        0 0 20px var(--color-green),
        0 0 30px var(--color-green),
        0 0 40px var(--color-green),
        0 0 50px rgba(0, 255, 0, 0.8);
    }
  }

  .logo-subtitle {
    font-size: clamp(10px, 2vw, 14px);
    color: var(--color-cyan);
    text-shadow: 0 0 10px var(--color-cyan);
    margin-top: 10px;
    letter-spacing: 2px;
  }

  .logo-decoration {
    color: var(--color-yellow);
    font-size: clamp(8px, 1.5vw, 12px);
    margin: 10px 0;
    opacity: 0.7;
  }

  /* Small Logo for Navbar */
  .small-logo {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .small-logo-icon {
    font-size: 24px;
    color: var(--color-green);
    text-shadow: 0 0 10px var(--color-green);
  }

  .small-logo-text {
    font-size: 16px;
    color: var(--color-green);
    text-shadow: 0 0 8px var(--color-green);
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* UI COMPONENTS */
  /* ═══════════════════════════════════════════════════════════════ */
  .navbar {
    background: var(--color-secondary);
    border-bottom: 4px solid var(--color-green);
    box-shadow: 0 4px 20px rgba(0, 255, 0, 0.3);
    position: relative;
    z-index: 10;
    width: 100%;
    padding: 1rem;
  }

  .stat-box {
    background: var(--color-bg);
    border: 3px solid;
    padding: 12px 16px;
    box-shadow: 0 0 20px currentColor, inset 0 0 10px rgba(255, 255, 255, 0.05);
    transition: transform 0.2s;
  }

  .stat-box:hover {
    transform: scale(1.05);
  }

  .stat-box.score { border-color: var(--color-magenta); }
  .stat-box.streak { border-color: var(--color-cyan); }
  .stat-box.lives { border-color: var(--color-red); }
  .stat-box.powerup { border-color: var(--color-purple); min-height: 80px; }

  .stat-label {
    font-size: 10px;
    opacity: 0.7;
    margin-bottom: 8px;
    text-transform: uppercase;
  }

  .stat-value {
    font-size: 24px;
    text-shadow: 0 0 20px currentColor;
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* QUIZ AREA */
  /* ═══════════════════════════════════════════════════════════════ */
  .quiz-area {
    background: var(--color-primary);
    border: 4px solid var(--color-green);
    box-shadow: 
      0 0 30px rgba(0, 255, 0, 0.4),
      inset 0 0 30px rgba(0, 255, 0, 0.05);
    position: relative;
    padding: 32px;
    margin: 20px;
  }

  .quiz-area.boss-mode {
    border-color: var(--color-red);
    box-shadow: 
      0 0 40px rgba(255, 0, 110, 0.8),
      inset 0 0 30px rgba(255, 0, 110, 0.1);
    animation: bossPulse 1s infinite;
  }

  @keyframes bossPulse {
    0%, 100% { 
      box-shadow: 
        0 0 30px rgba(255, 0, 110, 0.8),
        inset 0 0 30px rgba(255, 0, 110, 0.1);
    }
    50% { 
      box-shadow: 
        0 0 60px rgba(255, 0, 110, 1),
        inset 0 0 50px rgba(255, 0, 110, 0.2);
    }
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* BUTTONS */
  /* ═══════════════════════════════════════════════════════════════ */
  .retro-btn {
    background: linear-gradient(180deg, #333 0%, #111 100%);
    border: 3px solid;
    padding: 16px 24px;
    font-size: 12px;
    text-transform: uppercase;
    position: relative;
    transition: all 0.1s;
    box-shadow: 0 4px 0 #000, 0 6px 10px rgba(0, 0, 0, 0.5);
    user-select: none;
    outline: none;
    font-family: 'Press Start 2P', monospace;
    cursor: none;
    display: block;
    width: 100%;
    text-align: center;
  }

  .retro-btn:hover {
    transform: translateY(2px);
  }

  .retro-btn:active {
    transform: translateY(4px);
    box-shadow: 0 0 0 #000, 0 2px 5px rgba(0, 0, 0, 0.5);
  }

  .retro-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    transform: none !important;
  }

  .retro-btn.selected-btn {
    transform: scale(1.05) translateY(-2px);
    box-shadow: 
      0 0 30px currentColor,
      0 0 15px currentColor inset,
      0 6px 0 #000;
    border-width: 4px !important;
  }

  .retro-btn.selected-btn::before {
    content: "▶";
    position: absolute;
    left: 10px;
    color: var(--color-yellow);
    animation: blink 0.8s infinite;
  }

  .retro-btn.selected-btn::after {
    content: "◀";
    position: absolute;
    right: 10px;
    color: var(--color-yellow);
    animation: blink 0.8s infinite;
  }

  /* Button Colors */
  .retro-btn.asset {
    border-color: var(--color-red);
    color: var(--color-red);
    background: linear-gradient(180deg, var(--color-dark-red) 0%, #220011 100%);
  }

  .retro-btn.liability {
    border-color: var(--color-blue);
    color: var(--color-blue);
    background: linear-gradient(180deg, var(--color-dark-blue) 0%, #001122 100%);
  }

  .retro-btn.income {
    border-color: var(--color-green);
    color: var(--color-green);
    background: linear-gradient(180deg, var(--color-dark-green) 0%, #001100 100%);
  }

  .retro-btn.expense {
    border-color: var(--color-yellow);
    color: var(--color-yellow);
    background: linear-gradient(180deg, var(--color-dark-yellow) 0%, #221100 100%);
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* PROGRESS BAR / TIMER */
  /* ═══════════════════════════════════════════════════════════════ */
  .progress-container {
    background: #0a0a0a;
    border: 2px solid var(--color-green);
    height: 16px;
    position: relative;
    overflow: hidden;
  }

  .progress-fill {
    background: linear-gradient(
      90deg,
      var(--color-green) 0%,
      var(--color-cyan) 50%,
      var(--color-magenta) 100%
    );
    height: 100%;
    transition: width 0.05s linear;
    box-shadow: 0 0 15px currentColor;
  }

  .progress-fill.warning {
    background: linear-gradient(90deg, var(--color-red) 0%, var(--color-yellow) 100%);
    animation: blink 0.5s infinite;
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* SCREENS */
  /* ═══════════════════════════════════════════════════════════════ */
  .screen {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(10, 10, 26, 0.98);
    z-index: 50;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 40px 20px;
    transition: opacity 0.5s, visibility 0.5s;
    overflow-y: auto; /* Only scroll within screen if content is too tall */
    overflow-x: hidden;
  }

  .screen.hidden {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
  }

  /* Custom Scrollbar (Optional - makes it prettier) */
  .screen::-webkit-scrollbar {
    width: 8px;
  }

  .screen::-webkit-scrollbar-track {
    background: var(--color-bg);
    border: 1px solid var(--color-green);
  }

  .screen::-webkit-scrollbar-thumb {
    background: var(--color-green);
    box-shadow: 0 0 10px var(--color-green);
  }

  .screen::-webkit-scrollbar-thumb:hover {
    background: var(--color-cyan);
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* ANIMATIONS */
  /* ═══════════════════════════════════════════════════════════════ */
  @keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }

  .blink {
    animation: blink 1s infinite;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .fade-in {
    animation: fadeIn 0.5s ease-out;
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* QUESTION TEXT */
  /* ═══════════════════════════════════════════════════════════════ */
  .question-text {
    color: var(--color-cyan);
    text-shadow: 0 0 10px var(--color-cyan);
    line-height: 1.8;
    min-height: 60px;
    font-size: clamp(14px, 3vw, 20px);
    margin: 20px 0;
  }

  .question-text.boss {
    color: var(--color-red);
    text-shadow: 0 0 20px var(--color-red);
    font-size: clamp(18px, 4vw, 28px);
    animation: bossPulse 1s infinite;
  }

  #answer-feedback {
    min-height: 40px;
    font-size: 14px;
    margin-top: 20px;
    text-shadow: 0 0 10px currentColor;
    font-weight: bold;
  }

  #answer-feedback.correct {
    color: var(--color-green);
  }

  #answer-feedback.wrong {
    color: var(--color-red);
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* MODAL & POPUPS */
  /* ═══════════════════════════════════════════════════════════════ */
  .modal-content {
    background: var(--color-secondary);
    border: 4px solid var(--color-green);
    padding: 40px;
    box-shadow: 
      0 0 50px var(--color-green),
      inset 0 0 30px rgba(0, 255, 0, 0.1);
    animation: modalAppear 0.5s;
    max-width: 90%;
    position: relative;
  }

  @keyframes modalAppear {
    from {
      transform: scale(0.8) rotate(2deg);
      opacity: 0;
    }
    to {
      transform: scale(1) rotate(0deg);
      opacity: 1;
    }
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* HIGH SCORE INPUT */
  /* ═══════════════════════════════════════════════════════════════ */
  #initials-input {
    font-family: 'Press Start 2P', monospace;
    background: var(--color-bg);
    border: 3px solid var(--color-cyan);
    color: var(--color-cyan);
    text-align: center;
    font-size: 2rem;
    width: 150px;
    padding: 15px;
    margin: 20px auto;
    text-transform: uppercase;
    outline: none;
    box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.3);
    display: block;
  }

  #initials-input:focus {
    box-shadow: 
      inset 0 0 10px rgba(0, 255, 255, 0.5),
      0 0 20px var(--color-cyan);
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* HIGH SCORE TABLE */
  /* ═══════════════════════════════════════════════════════════════ */
  #high-score-table {
    list-style: none;
    padding: 0;
    margin: 30px auto;
    max-width: 500px;
    width: 100%;
  }

  #high-score-table li {
    display: flex;
    justify-content: space-between;
    padding: 12px 20px;
    font-size: 11px;
    border-bottom: 1px solid #333;
    transition: all 0.2s;
  }

  #high-score-table li:hover {
    background: rgba(0, 255, 0, 0.05);
    border-color: var(--color-green);
  }

  #high-score-table li .score {
    color: var(--color-yellow);
    text-shadow: 0 0 10px var(--color-yellow);
  }

  #high-score-table li:nth-child(1) {
    color: var(--color-green);
    font-size: 14px;
    background: rgba(0, 255, 0, 0.1);
    border: 2px solid var(--color-green);
  }

  #high-score-table li:nth-child(2) {
    color: var(--color-cyan);
  }

  #high-score-table li:nth-child(3) {
    color: var(--color-yellow);
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* ACHIEVEMENT POPUP */
  /* ═══════════════════════════════════════════════════════════════ */
  .achievement-popup {
    position: fixed;
    top: 100px;
    right: -400px;
    background: var(--color-secondary);
    border: 3px solid var(--color-yellow);
    padding: 20px;
    box-shadow: 0 0 30px var(--color-yellow);
    z-index: 200;
    transition: right 0.5s;
    max-width: 300px;
  }

  .achievement-popup.show {
    right: 20px;
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* POWER-UPS */
  /* ═══════════════════════════════════════════════════════════════ */
  .powerup-icon {
    display: inline-block;
    width: 24px;
    height: 24px;
    margin: 0 4px;
    border: 2px solid;
    animation: float 2s infinite;
    font-size: 16px;
    line-height: 20px;
    text-align: center;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-8px); }
  }

  .powerup-icon.shield {
    background: var(--color-blue);
    border-color: var(--color-cyan);
  }

  .powerup-icon.time {
    background: var(--color-purple);
    border-color: var(--color-magenta);
  }

  .powerup-icon.double {
    background: var(--color-orange);
    border-color: var(--color-yellow);
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* COMBO METER */
  /* ═══════════════════════════════════════════════════════════════ */
  .combo-meter {
    position: fixed;
    top: 50%;
    right: -200px;
    transform: translateY(-50%);
    width: 150px;
    text-align: center;
    transition: right 0.3s;
    z-index: 150;
    background: var(--color-secondary);
    border: 3px solid var(--color-cyan);
    padding: 20px;
    box-shadow: 0 0 20px var(--color-cyan);
  }

  .combo-meter.active {
    right: 20px;
  }

  #combo-display {
    font-size: 48px;
    color: var(--color-cyan);
    text-shadow: 0 0 20px var(--color-cyan);
    margin-top: 10px;
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* PARTICLE CANVAS */
  /* ═══════════════════════════════════════════════════════════════ */
  #particle-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 100;
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* PAUSE OVERLAY */
  /* ═══════════════════════════════════════════════════════════════ */
  #pause-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(10, 10, 10, 0.95);
    z-index: 150;
    display: none;
    justify-content: center;
    align-items: center;
  }

  #pause-overlay.active {
    display: flex;
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* KEY HINTS */
  /* ═══════════════════════════════════════════════════════════════ */
  .key-hint {
    display: inline-block;
    background: #222;
    border: 2px solid var(--color-cyan);
    padding: 4px 8px;
    margin: 0 4px;
    font-size: 10px;
    box-shadow: 0 2px 0 #000;
    color: var(--color-cyan);
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* BOSS WARNING */
  /* ═══════════════════════════════════════════════════════════════ */
  .boss-warning {
    animation: bossWarning 0.5s infinite;
    color: var(--color-red);
    font-size: clamp(20px, 5vw, 36px);
    text-shadow: 0 0 30px var(--color-red);
    margin: 20px 0;
  }

  @keyframes bossWarning {
    0%, 100% {
      transform: scale(1);
      opacity: 1;
    }
    50% {
      transform: scale(1.1);
      opacity: 0.7;
    }
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* RESPONSIVE DESIGN */
  /* ═══════════════════════════════════════════════════════════════ */
  @media (max-width: 768px) {
    body {
      font-size: 10px;
    }

    .retro-btn {
      padding: 12px 16px;
      font-size: 10px;
    }

    .quiz-area {
      padding: 20px;
      margin: 10px;
    }

    .modal-content {
      padding: 20px;
    }

    .stat-value {
      font-size: 18px;
    }

    .combo-meter.active {
      right: 10px;
    }

    .achievement-popup.show {
      right: 10px;
      max-width: 250px;
    }
  }

  /* ═══════════════════════════════════════════════════════════════ */
  /* UTILITIES */
  /* ═══════════════════════════════════════════════════════════════ */
  .text-glow {
    text-shadow: 0 0 10px currentColor;
  }

  .hidden {
    display: none !important;
  }
</style>
</head>
<body>

<!-- Custom Cursor -->
<div id="custom-cursor"></div>

<div id="crt-screen">
  <canvas id="particle-canvas"></canvas>

  <!-- ACHIEVEMENT POPUP -->
  <div id="achievement-popup" class="achievement-popup">
    <div style="font-size: 10px; color: var(--color-yellow); text-transform: uppercase;">
      🏆 Achievement Unlocked!
    </div>
    <div id="achievement-text" style="margin-top: 10px; font-size: 11px; line-height: 1.6;"></div>
  </div>

  <!-- COMBO METER -->
  <div id="combo-meter" class="combo-meter">
    <div style="font-size: 10px; color: var(--color-yellow);">COMBO</div>
    <div id="combo-display">x0</div>
  </div>

  <!-- PAUSE OVERLAY -->
  <div id="pause-overlay">
    <div class="modal-content">
      <h2 class="text-2xl mb-6 blink" style="color: var(--color-cyan);">
        ⏸ PAUSED
      </h2>
      <p class="text-xs mb-4" style="line-height: 2;">
        Press <span class="key-hint">P</span> to resume<br>
        Press <span class="key-hint">Q</span> to quit
      </p>
      <div class="mt-8">
        <div class="text-xs mb-4" style="color: var(--color-green);">CONTROLS:</div>
        <div class="text-xs" style="line-height: 2;">
          <span class="key-hint">A</span> Asset<br>
          <span class="key-hint">B</span> Liability<br>
          <span class="key-hint">C</span> Income<br>
          <span class="key-hint">D</span> Expense
        </div>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!-- START SCREEN -->
  <!-- ═══════════════════════════════════════════════════════════ -->
  <div id="start-screen" class="screen">
    <div class="main-logo fade-in">
      <div class="logo-decoration">▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼</div>
      <h1 class="logo-title">
        ACCOUNTS<br>WIZARD DX
      </h1>
      <div class="logo-decoration">▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲</div>
      <p class="logo-subtitle">ARCADE EDITION v2.5</p>
    </div>

    <div style="margin: 60px 0 40px 0; max-width: 500px; width: 100%;">
      <div class="text-xs mb-6" style="color: var(--color-cyan); line-height: 1.8;">
        SELECT YOUR CHALLENGE
      </div>
      
      <div id="game-mode-selection" class="flex flex-col gap-4">
        <button class="retro-btn income" data-mode="classic">
          🎮 CLASSIC MODE
        </button>
        <button class="retro-btn expense" data-mode="timeAttack">
          ⏱ TIME ATTACK
        </button>
        <button class="retro-btn asset" data-mode="suddenDeath">
          ⚡ SUDDEN DEATH
        </button>
        <button class="retro-btn liability" data-mode="bossRush">
          👹 BOSS RUSH
        </button>
      </div>
    </div>

    <p class="text-xs" style="color: var(--color-yellow); margin-top: 40px;">
      <span class="key-hint">↑</span> <span class="key-hint">↓</span> Navigate
      <span class="key-hint">ENTER</span> Select
    </p>

    <button class="retro-btn liability" id="quit-to-main-btn" 
            style="margin-top: 40px; max-width: 300px;">
      ← BACK TO MAIN SITE
    </button>
  </div>

    <!-- ═══════════════════════════════════════════════════════════ -->
    <!-- QUIZ SCREEN -->
    <!-- ═══════════════════════════════════════════════════════════ -->
    <div id="quiz-screen" class="screen hidden">
      <!-- Navbar -->
      <nav class="navbar">
        <div class="max-w-7xl mx-auto flex justify-between items-center flex-wrap gap-4">
          <div class="small-logo">
            <div class="small-logo-icon">🧙</div>
            <span class="small-logo-text">WIZARD</span>
          </div>
          
          <div class="flex items-center gap-4 flex-wrap">
            <div id="game-mode-display" class="text-xs uppercase" 
                style="color: var(--color-yellow);">
            </div>
            <div class="text-xs" style="color: var(--color-cyan);">
              <span class="key-hint">P</span> Pause 
              <span class="key-hint">Q</span> Quit
            </div>
          </div>
        </div>
      </nav>

      <main class="max-w-6xl mx-auto p-4 w-full" style="margin-top: 100px;">
        <!-- Stats Grid -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
          <div class="stat-box score">
            <div class="stat-label">SCORE</div>
            <div class="stat-value" id="score" style="color: var(--color-magenta);">
              000000
            </div>
          </div>
          
          <div class="stat-box streak">
            <div class="stat-label">STREAK</div>
            <div class="stat-value" id="streak" style="color: var(--color-cyan);">
              x0
            </div>
          </div>
          
          <div class="stat-box lives" id="lives-container">
            <div class="stat-label">LIVES</div>
            <div class="stat-value" id="lives" style="color: var(--color-red);">
              ♥♥♥
            </div>
          </div>
          
          <div class="stat-box powerup">
            <div class="stat-label">POWER-UPS</div>
            <div id="powerups-active" class="text-xs mt-2"></div>
          </div>
        </div>

        <!-- Quiz Area -->
        <div class="quiz-area" id="quiz-area">
          <!-- Timer Bar -->
          <div class="progress-container mb-6">
            <div id="timer-bar" class="progress-fill" style="width: 100%;"></div>
          </div>

          <!-- Question Section -->
          <div class="text-center mb-8">
            <div class="text-xs mb-4" style="color: var(--color-green); letter-spacing: 2px;">
              <span id="question-number">LEVEL 1/10</span>
            </div>
            
            <div id="boss-warning" class="boss-warning hidden">
              ⚠ BOSS BATTLE ⚠
            </div>
            
            <div id="question-text" class="question-text">
              INITIALIZING SYSTEM...
            </div>
            
            <div id="answer-feedback"></div>
          </div>

          <!-- Answer Buttons -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <button class="retro-btn asset" data-option="Asset" data-key="a">
              [A] ASSET
            </button>
            <button class="retro-btn liability" data-option="Liability" data-key="b">
              [B] LIABILITY
            </button>
            <button class="retro-btn income" data-option="Income" data-key="c">
              [C] INCOME
            </button>
            <button class="retro-btn expense" data-option="Expense" data-key="d">
              [D] EXPENSE
            </button>
          </div>
        </div>
      </main>
    </div>

    <!-- ═══════════════════════════════════════════════════════════ -->
    <!-- GAME OVER SCREEN -->
    <!-- ═══════════════════════════════════════════════════════════ -->
    <div id="game-over-screen" class="screen hidden">
      <div class="modal-content fade-in">
        <h2 id="game-over-title" class="text-3xl mb-6 blink" 
            style="color: var(--color-red); text-shadow: 0 0 20px var(--color-red);">
          GAME OVER
        </h2>
        
        <p id="game-over-message" class="mb-6 text-sm" style="color: var(--color-cyan);"></p>
        
        <!-- Final Stats -->
        <div class="mb-6">
          <div class="text-xs mb-3" style="color: var(--color-cyan);">FINAL SCORE</div>
          <div class="text-5xl mb-6" id="final-score" 
              style="color: var(--color-magenta); text-shadow: 0 0 20px var(--color-magenta);">
            0
          </div>
          
          <div class="text-xs" style="color: var(--color-yellow); line-height: 2;">
            <div>Max Streak: <span id="max-streak-display" class="text-glow">0</span></div>
            <div>Accuracy: <span id="accuracy-display" class="text-glow">0%</span></div>
            <div id="achievements-earned-display" class="mt-2"></div>
          </div>
        </div>

        <!-- New High Score Section -->
        <div id="new-high-score-section" class="hidden">
          <p style="color: var(--color-yellow); font-size: 16px; margin-bottom: 20px;" class="blink">
            🏆 NEW HIGH SCORE! 🏆
          </p>
          <p class="text-xs mt-4 mb-2">ENTER YOUR INITIALS:</p>
          <input type="text" id="initials-input" maxlength="3" placeholder="AAA">
          <button id="save-score-btn" class="retro-btn income" style="margin-top: 20px; max-width: 200px;">
            SAVE SCORE
          </button>
        </div>

        <!-- Game Over Controls -->
        <div id="game-over-controls" class="flex flex-col gap-4" style="margin-top: 30px; max-width: 400px;">
          <button id="restart-btn" class="retro-btn income">
            🔄 PLAY AGAIN
          </button>
          <button id="view-high-scores-btn" class="retro-btn expense">
            🏆 HIGH SCORES
          </button>
        </div>
      </div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════ -->
    <!-- HIGH SCORE SCREEN -->
    <!-- ═══════════════════════════════════════════════════════════ -->
    <div id="high-score-screen" class="screen hidden">
      <div class="modal-content w-full max-w-2xl fade-in">
        <h2 class="text-3xl mb-8" 
            style="color: var(--color-yellow); text-shadow: 0 0 20px var(--color-yellow);">
          🏆 HALL OF FAME 🏆
        </h2>
        
        <ul id="high-score-table"></ul>
        
        <button id="back-to-menu-btn" class="retro-btn income" 
                style="margin-top: 30px; max-width: 300px;">
          ← MAIN MENU
        </button>
      </div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════ -->
    <!-- QUIT CONFIRM SCREEN -->
    <!-- ═══════════════════════════════════════════════════════════ -->
    <div id="quit-confirm-screen" class="screen hidden" 
        style="background: rgba(10, 10, 10, 0.95); z-index: 160;">
      <div class="modal-content fade-in">
        <h2 class="text-xl mb-6" style="color: var(--color-yellow);">
          ⚠ WHERE DO YOU WANT TO GO?
        </h2>
        
        <p class="text-xs mb-8" style="color: var(--color-red);">
          All progress in this round will be lost!
        </p>
        
        <div class="flex flex-col gap-4 max-w-sm">
          <button id="quit-to-menu-btn" class="retro-btn income">
            🎮 MAIN MENU
          </button>
          <button id="confirm-quit-btn" class="retro-btn asset">
            🌐 MAIN SITE
          </button>
          <button id="cancel-quit-btn" class="retro-btn expense">
            ▶ CONTINUE GAME
          </button>
        </div>
        
        <p class="text-xs mt-8" style="color: var(--color-cyan);">
          <span class="key-hint">↑</span> <span class="key-hint">↓</span> Navigate
          <span class="key-hint">ENTER</span> Select
        </p>
      </div>
    </div>

  </div>
  <!-- End of CRT Screen -->
   <script>
// ═══════════════════════════════════════════════════════════════════════════
// ACCOUNTS WIZARD DX - ARCADE EDITION v2.5
// A retro-style accounting quiz game
// ═══════════════════════════════════════════════════════════════════════════

"use strict";

// ═══════════════════════════════════════════════════════════════════════════
// CONFIGURATION
// ═══════════════════════════════════════════════════════════════════════════
const CONFIG = {
  MAIN_QUIZ_URL: "../index.html", // ⚠️ CHANGE THIS TO YOUR MAIN SITE URL
  
  GAME_MODES: {
    classic: {
      totalQuestions: 10,
      timePerQuestion: 10,
      name: "CLASSIC MODE",
      hasLives: false,
      description: "Answer 10 questions correctly"
    },
    timeAttack: {
      totalTime: 60,
      timePerQuestion: 10,
      name: "TIME ATTACK",
      hasLives: false,
      description: "Score as much as you can in 60 seconds"
    },
    suddenDeath: {
      timePerQuestion: 7,
      name: "SUDDEN DEATH",
      hasLives: false,
      description: "One mistake and you're done!"
    },
    bossRush: {
      timePerQuestion: 12,
      name: "BOSS RUSH",
      hasLives: true,
      lives: 5,
      totalQuestions: 30,
      description: "Face 30 challenging boss questions"
    }
  },
  
  POINTS: {
    perCorrect: 100,
    streakBonus: 50,
    timeBonusMultiplier: 10,
    difficultyMultiplier: 50,
    bossBonus: 500
  },
  
  STORAGE_KEY: 'accountsWizardHighScores_v2'
};

// ═══════════════════════════════════════════════════════════════════════════
// CUSTOM CURSOR
// ═══════════════════════════════════════════════════════════════════════════
const customCursor = {
  element: null,
  
  init() {
    this.element = document.getElementById('custom-cursor');
    
    document.addEventListener('mousemove', (e) => {
      this.element.style.display = 'block';
      this.element.style.left = e.clientX + 'px';
      this.element.style.top = e.clientY + 'px';
    });
    
    document.addEventListener('mousedown', () => {
      this.element.style.transform = 'translate(-50%, -50%) scale(0.8)';
    });
    
    document.addEventListener('mouseup', () => {
      this.element.style.transform = 'translate(-50%, -50%) scale(1)';
    });
  }
};

// ═══════════════════════════════════════════════════════════════════════════
// SOUND MANAGER
// ═══════════════════════════════════════════════════════════════════════════
const soundManager = {
  audioContext: null,
  isMuted: false,
  
  init() {
    try {
      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
    } catch (e) {
      console.warn("Web Audio API is not supported in this browser");
    }
  },
  
  play(soundName) {
    if (this.isMuted || !this.audioContext) return;
    
    // Resume audio context if suspended (browser autoplay policy)
    if (this.audioContext.state === 'suspended') {
      this.audioContext.resume();
    }
    
    const now = this.audioContext.currentTime;
    const oscillator = this.audioContext.createOscillator();
    const gainNode = this.audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(this.audioContext.destination);
    
    switch(soundName) {
      case 'select':
        oscillator.frequency.setValueAtTime(600, now);
        oscillator.frequency.exponentialRampToValueAtTime(400, now + 0.1);
        gainNode.gain.setValueAtTime(0.2, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
        oscillator.start(now);
        oscillator.stop(now + 0.1);
        break;
        
      case 'confirm':
        oscillator.frequency.setValueAtTime(400, now);
        oscillator.frequency.exponentialRampToValueAtTime(800, now + 0.15);
        gainNode.gain.setValueAtTime(0.25, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
        oscillator.start(now);
        oscillator.stop(now + 0.15);
        break;
        
      case 'correct':
        oscillator.type = 'square';
        oscillator.frequency.setValueAtTime(523.25, now);
        oscillator.frequency.setValueAtTime(659.25, now + 0.1);
        oscillator.frequency.setValueAtTime(783.99, now + 0.2);
        gainNode.gain.setValueAtTime(0.3, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
        oscillator.start(now);
        oscillator.stop(now + 0.3);
        break;
        
      case 'wrong':
        oscillator.frequency.setValueAtTime(300, now);
        oscillator.frequency.exponentialRampToValueAtTime(100, now + 0.4);
        gainNode.gain.setValueAtTime(0.3, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
        oscillator.start(now);
        oscillator.stop(now + 0.4);
        break;
        
      case 'gameOver':
        oscillator.type = 'sawtooth';
        oscillator.frequency.setValueAtTime(400, now);
        oscillator.frequency.exponentialRampToValueAtTime(100, now + 0.8);
        gainNode.gain.setValueAtTime(0.4, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.8);
        oscillator.start(now);
        oscillator.stop(now + 0.8);
        break;
        
      case 'powerup':
        oscillator.type = 'triangle';
        oscillator.frequency.setValueAtTime(600, now);
        oscillator.frequency.exponentialRampToValueAtTime(1400, now + 0.25);
        gainNode.gain.setValueAtTime(0.25, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.25);
        oscillator.start(now);
        oscillator.stop(now + 0.25);
        break;
        
      case 'achievement':
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(440, now);
        oscillator.frequency.setValueAtTime(554.37, now + 0.1);
        oscillator.frequency.setValueAtTime(659.25, now + 0.2);
        oscillator.frequency.setValueAtTime(880, now + 0.3);
        gainNode.gain.setValueAtTime(0.25, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
        oscillator.start(now);
        oscillator.stop(now + 0.5);
        break;
        
      case 'boss':
        oscillator.type = 'sawtooth';
        oscillator.frequency.setValueAtTime(80, now);
        oscillator.frequency.exponentialRampToValueAtTime(40, now + 0.6);
        gainNode.gain.setValueAtTime(0.4, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.6);
        oscillator.start(now);
        oscillator.stop(now + 0.6);
        break;
        
      case 'win':
        oscillator.type = 'triangle';
        oscillator.frequency.setValueAtTime(523.25, now);
        oscillator.frequency.setValueAtTime(659.25, now + 0.15);
        oscillator.frequency.setValueAtTime(783.99, now + 0.3);
        oscillator.frequency.setValueAtTime(1046.50, now + 0.45);
        gainNode.gain.setValueAtTime(0.3, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.7);
        oscillator.start(now);
        oscillator.stop(now + 0.7);
        break;
    }
  },
  
  toggleMute() {
    this.isMuted = !this.isMuted;
    return this.isMuted;
  }
};

// Initialize sound
soundManager.init();
customCursor.init();

// ═══════════════════════════════════════════════════════════════════════════
// PART 3B: PARTICLE SYSTEM
// ═══════════════════════════════════════════════════════════════════════════

const particleManager = {
  canvas: null,
  ctx: null,
  particles: [],
  
  init() {
    this.canvas = document.getElementById('particle-canvas');
    this.ctx = this.canvas.getContext('2d');
    this.resizeCanvas();
    
    window.addEventListener('resize', () => this.resizeCanvas());
    this.animate();
  },
  
  resizeCanvas() {
    this.canvas.width = this.canvas.parentElement.clientWidth;
    this.canvas.height = this.canvas.parentElement.clientHeight;
  },
  
  createExplosion(x, y, color, count = 50) {
    for (let i = 0; i < count; i++) {
      this.particles.push(new Particle(x, y, color));
    }
  },
  
  createText(x, y, text, color) {
    this.particles.push(new TextParticle(x, y, text, color));
  },
  
  animate() {
    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
    
    for (let i = this.particles.length - 1; i >= 0; i--) {
      const particle = this.particles[i];
      
      if (particle.alpha <= 0) {
        this.particles.splice(i, 1);
      } else {
        particle.update();
        particle.draw(this.ctx);
      }
    }
    
    requestAnimationFrame(() => this.animate());
  }
};

// Particle Class
class Particle {
  constructor(x, y, color) {
    this.x = x;
    this.y = y;
    this.color = color;
    this.size = Math.random() * 6 + 2;
    
    const angle = Math.random() * Math.PI * 2;
    const speed = Math.random() * 8 + 2;
    
    this.vx = Math.cos(angle) * speed;
    this.vy = Math.sin(angle) * speed;
    this.alpha = 1;
    this.decay = Math.random() * 0.02 + 0.01;
    this.gravity = 0.15;
  }
  
  update() {
    this.x += this.vx;
    this.y += this.vy;
    this.vy += this.gravity;
    this.alpha -= this.decay;
    
    // Slow down
    this.vx *= 0.98;
  }
  
  draw(ctx) {
    ctx.globalAlpha = this.alpha;
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x - this.size / 2, this.y - this.size / 2, this.size, this.size);
    
    // Glow effect
    ctx.shadowBlur = 10;
    ctx.shadowColor = this.color;
    ctx.fillRect(this.x - this.size / 2, this.y - this.size / 2, this.size, this.size);
    ctx.shadowBlur = 0;
    
    ctx.globalAlpha = 1;
  }
}

// Text Particle Class
class TextParticle {
  constructor(x, y, text, color) {
    this.x = x;
    this.y = y;
    this.text = text;
    this.color = color;
    this.vy = -2.5;
    this.alpha = 1;
    this.decay = 0.012;
  }
  
  update() {
    this.y += this.vy;
    this.alpha -= this.decay;
    this.vy *= 0.95; // Slow down
  }
  
  draw(ctx) {
    ctx.globalAlpha = this.alpha;
    ctx.font = 'bold 24px "Press Start 2P"';
    ctx.fillStyle = this.color;
    ctx.textAlign = 'center';
    
    // Glow effect
    ctx.shadowBlur = 15;
    ctx.shadowColor = this.color;
    ctx.fillText(this.text, this.x, this.y);
    ctx.shadowBlur = 0;
    
    ctx.globalAlpha = 1;
  }
}

// ═══════════════════════════════════════════════════════════════════════════
// PART 3C: QUESTION DATA
// ═══════════════════════════════════════════════════════════════════════════

const questionsPool = [
  // Easy Questions (Difficulty 1)
  { q: "Cash", a: "Asset", difficulty: 1 },
  { q: "Salaries Paid", a: "Expense", difficulty: 1 },
  { q: "Accounts Payable", a: "Liability", difficulty: 1 },
  { q: "Service Revenue", a: "Income", difficulty: 1 },
  { q: "Office Furniture", a: "Asset", difficulty: 1 },
  { q: "Rent Received", a: "Income", difficulty: 1 },
  { q: "Bank Loan", a: "Liability", difficulty: 1 },
  { q: "Office Supplies", a: "Asset", difficulty: 1 },
  { q: "Interest Earned", a: "Income", difficulty: 1 },
  { q: "Electricity Bill", a: "Expense", difficulty: 1 },
  { q: "Buildings", a: "Asset", difficulty: 1 },
  { q: "Sales Revenue", a: "Income", difficulty: 1 },
  { q: "Wages Expense", a: "Expense", difficulty: 1 },
  { q: "Inventory", a: "Asset", difficulty: 1 },
  { q: "Consulting Fees", a: "Income", difficulty: 1 },
  { q: "Insurance Expense", a: "Expense", difficulty: 1 },
  { q: "Land", a: "Asset", difficulty: 1 },
  { q: "Commission Earned", a: "Income", difficulty: 1 },
  { q: "Advertising Expense", a: "Expense", difficulty: 1 },
  { q: "Equipment", a: "Asset", difficulty: 1 },
  { q: "Rental Income", a: "Income", difficulty: 1 },
  { q: "Telephone Expense", a: "Expense", difficulty: 1 },
  { q: "Vehicles", a: "Asset", difficulty: 1 },
  { q: "Utilities Expense", a: "Expense", difficulty: 1 },
  { q: "Petty Cash", a: "Asset", difficulty: 1 },
  { q: "Office Rent", a: "Expense", difficulty: 1 },
  
  // Medium Questions (Difficulty 2)
  { q: "Prepaid Insurance", a: "Asset", difficulty: 2 },
  { q: "Owner's Capital", a: "Liability", difficulty: 2 },
  { q: "Accounts Receivable", a: "Asset", difficulty: 2 },
  { q: "Notes Payable", a: "Liability", difficulty: 2 },
  { q: "Mortgage Payable", a: "Liability", difficulty: 2 },
  { q: "Bonds Payable", a: "Liability", difficulty: 2 },
  { q: "Depreciation Expense", a: "Expense", difficulty: 2 },
  { q: "Patents", a: "Asset", difficulty: 2 },
  { q: "Royalty Income", a: "Income", difficulty: 2 },
  { q: "Taxes Payable", a: "Liability", difficulty: 2 },
  { q: "Cost of Goods Sold", a: "Expense", difficulty: 2 },
  { q: "Dividend Income", a: "Income", difficulty: 2 },
  { q: "Salaries Payable", a: "Liability", difficulty: 2 },
  { q: "Trademarks", a: "Asset", difficulty: 2 },
  { q: "Investment in Stocks", a: "Asset", difficulty: 2 },
  { q: "Subscription Revenue", a: "Income", difficulty: 2 },
  
  // Hard Questions (Difficulty 3)
  { q: "Unearned Revenue", a: "Liability", difficulty: 3 },
  { q: "Accrued Expenses", a: "Liability", difficulty: 3 },
  { q: "Goodwill", a: "Asset", difficulty: 3 },
  { q: "Gain on Sale of Asset", a: "Income", difficulty: 3 },
  { q: "Deferred Revenue", a: "Liability", difficulty: 3 },
  { q: "Bad Debt Expense", a: "Expense", difficulty: 3 },
  { q: "Warranty Liability", a: "Liability", difficulty: 3 },
  { q: "Accumulated Depreciation", a: "Asset", difficulty: 3 },
  { q: "Dividend Declared", a: "Liability", difficulty: 3 },
  { q: "Foreign Exchange Gain", a: "Income", difficulty: 3 },
  { q: "Amortization Expense", a: "Expense", difficulty: 3 },
  { q: "Treasury Stock", a: "Asset", difficulty: 3 },
];

// Boss Questions (Difficulty 5)
const bossQuestions = [
  { q: "BOSS: Contra-Asset Account", a: "Asset", difficulty: 5 },
  { q: "BOSS: Deferred Tax Asset", a: "Asset", difficulty: 5 },
  { q: "BOSS: Unrealized Holding Gain", a: "Income", difficulty: 5 },
  { q: "BOSS: Contingent Liability", a: "Liability", difficulty: 5 },
  { q: "BOSS: Impairment Loss", a: "Expense", difficulty: 5 },
  { q: "BOSS: LIFO Reserve", a: "Asset", difficulty: 5 },
  { q: "BOSS: Leasehold Improvements", a: "Asset", difficulty: 5 },
  { q: "BOSS: Goodwill Amortization", a: "Expense", difficulty: 5 },
  { q: "BOSS: Revenue from Barter", a: "Income", difficulty: 5 },
  { q: "BOSS: Pension Liability", a: "Liability", difficulty: 5 },
  { q: "BOSS: Capitalized Interest", a: "Asset", difficulty: 5 },
  { q: "BOSS: Stock-Based Compensation", a: "Expense", difficulty: 5 },
  { q: "BOSS: Allowance for Doubtful Accounts", a: "Asset", difficulty: 5 },
  { q: "BOSS: Deferred Tax Liability", a: "Liability", difficulty: 5 },
  { q: "BOSS: Restructuring Costs", a: "Expense", difficulty: 5 },
  { q: "BOSS: Preferred Stock Dividends", a: "Liability", difficulty: 5 },
  { q: "BOSS: Discontinued Operations", a: "Income", difficulty: 5 },
  { q: "BOSS: Asset Retirement Obligation", a: "Liability", difficulty: 5 },
];

// ═══════════════════════════════════════════════════════════════════════════
// PART 3D: ACHIEVEMENTS SYSTEM
// ═══════════════════════════════════════════════════════════════════════════

const achievementsSystem = {
  achievements: {
    firstBlood: {
      name: "First Blood",
      desc: "Answer your first question correctly",
      unlocked: false,
      icon: "🎯"
    },
    hotStreak: {
      name: "Hot Streak",
      desc: "Get a 5 streak combo",
      unlocked: false,
      icon: "🔥"
    },
    unstoppable: {
      name: "Unstoppable",
      desc: "Get a 10 streak combo",
      unlocked: false,
      icon: "⚡"
    },
    centurion: {
      name: "Centurion",
      desc: "Score 10,000 points in a single game",
      unlocked: false,
      icon: "💯"
    },
    perfectionist: {
      name: "Perfectionist",
      desc: "Complete a game with 100% accuracy",
      unlocked: false,
      icon: "✨"
    },
    speedDemon: {
      name: "Speed Demon",
      desc: "Answer a question in under 2 seconds",
      unlocked: false,
      icon: "⚡"
    },
    bossSlayer: {
      name: "Boss Slayer",
      desc: "Defeat a boss question",
      unlocked: false,
      icon: "👹"
    },
    champion: {
      name: "Champion",
      desc: "Win Boss Rush mode",
      unlocked: false,
      icon: "👑"
    },
    survivor: {
      name: "Survivor",
      desc: "Survive 20 questions",
      unlocked: false,
      icon: "💪"
    }
  },
  
  check(achievementKey) {
    if (!this.achievements[achievementKey]) return false;
    
    if (!this.achievements[achievementKey].unlocked) {
      this.achievements[achievementKey].unlocked = true;
      this.showAchievement(achievementKey);
      soundManager.play('achievement');
      return true;
    }
    return false;
  },
  
  showAchievement(key) {
    const popup = document.getElementById('achievement-popup');
    const text = document.getElementById('achievement-text');
    const achievement = this.achievements[key];
    
    text.innerHTML = `
      <div style="font-size: 24px; margin-bottom: 10px;">${achievement.icon}</div>
      <strong style="color: var(--color-yellow);">${achievement.name}</strong><br>
      <span style="font-size: 10px; color: var(--color-cyan);">${achievement.desc}</span>
    `;
    
    popup.classList.add('show');
    
    setTimeout(() => {
      popup.classList.remove('show');
    }, 3500);
  }
};

// ═══════════════════════════════════════════════════════════════════════════
// PART 3E: POWER-UPS SYSTEM
// ═══════════════════════════════════════════════════════════════════════════

const powerUpsSystem = {
  active: {
    shield: false,      // Protects from one wrong answer
    timeFreeze: false,  // Doubles time for next question
    doublePoints: false // Doubles points for next question
  },
  
  grant(powerUpType) {
    if (!this.active.hasOwnProperty(powerUpType)) return;
    
    this.active[powerUpType] = true;
    this.updateDisplay();
    soundManager.play('powerup');
  },
  
  use(powerUpType) {
    if (!this.active.hasOwnProperty(powerUpType)) return;
    
    this.active[powerUpType] = false;
    this.updateDisplay();
  },
  
  updateDisplay() {
    const container = document.getElementById('powerups-active');
    container.innerHTML = '';
    
    if (this.active.shield) {
      container.innerHTML += '<span class="powerup-icon shield" title="Shield Active">🛡</span>';
    }
    if (this.active.timeFreeze) {
      container.innerHTML += '<span class="powerup-icon time" title="Time Freeze">⏰</span>';
    }
    if (this.active.doublePoints) {
      container.innerHTML += '<span class="powerup-icon double" title="Double Points">×2</span>';
    }
    
    if (!this.active.shield && !this.active.timeFreeze && !this.active.doublePoints) {
      container.innerHTML = '<span style="opacity: 0.5; font-size: 10px;">NONE</span>';
    }
  },
  
  random() {
    const types = ['shield', 'timeFreeze', 'doublePoints'];
    return types[Math.floor(Math.random() * types.length)];
  },
  
  reset() {
    this.active.shield = false;
    this.active.timeFreeze = false;
    this.active.doublePoints = false;
    this.updateDisplay();
  },
};

// ═══════════════════════════════════════════════════════════════════════════
// PART 3F: MAIN GAME OBJECT - INITIALIZATION
// ═══════════════════════════════════════════════════════════════════════════

const game = {
  // Game State
  state: {
    mode: null,
    score: 0,
    streak: 0,
    maxStreak: 0,
    correctAnswers: 0,
    totalAnswered: 0,
    currentQuestionIndex: 0,
    questions: [],
    isGameOver: false,
    isPaused: false,
    timer: null,
    timeLeft: 0,
    lives: 3,
    questionsAnswered: 0,
    bossMode: false,
    answerStartTime: 0,
    keyboardNavIndex: 0,
    bossQuestionsDefeated: 0,
    timeLeftInQuestion: 0
  },
  
  // DOM Elements Cache
  elements: {
    screens: {
      start: document.getElementById('start-screen'),
      quiz: document.getElementById('quiz-screen'),
      gameOver: document.getElementById('game-over-screen'),
      highScore: document.getElementById('high-score-screen'),
      quitConfirm: document.getElementById('quit-confirm-screen')
    },
    questionNumber: document.getElementById('question-number'),
    questionText: document.getElementById('question-text'),
    score: document.getElementById('score'),
    streak: document.getElementById('streak'),
    timerBar: document.getElementById('timer-bar'),
    answerButtons: document.querySelectorAll('.retro-btn[data-option]'),
    answerFeedback: document.getElementById('answer-feedback'),
    finalScore: document.getElementById('final-score'),
    newHighScoreSection: document.getElementById('new-high-score-section'),
    initialsInput: document.getElementById('initials-input'),
    saveScoreBtn: document.getElementById('save-score-btn'),
    restartBtn: document.getElementById('restart-btn'),
    viewHighScoresBtn: document.getElementById('view-high-scores-btn'),
    highScoreTable: document.getElementById('high-score-table'),
    backToMenuBtn: document.getElementById('back-to-menu-btn'),
    gameModeButtons: document.querySelectorAll('#game-mode-selection button'),
    gameModeDisplay: document.getElementById('game-mode-display'),
    gameOverControls: document.getElementById('game-over-controls'),
    confirmQuitBtn: document.getElementById('confirm-quit-btn'),
    quitToMenuBtn: document.getElementById('quit-to-menu-btn'),
    cancelQuitBtn: document.getElementById('cancel-quit-btn'),
    pauseOverlay: document.getElementById('pause-overlay'),
    lives: document.getElementById('lives'),
    livesContainer: document.getElementById('lives-container'),
    quizArea: document.getElementById('quiz-area'),
    bossWarning: document.getElementById('boss-warning'),
    comboMeter: document.getElementById('combo-meter'),
    comboDisplay: document.getElementById('combo-display'),
    maxStreakDisplay: document.getElementById('max-streak-display'),
    accuracyDisplay: document.getElementById('accuracy-display'),
    achievementsEarnedDisplay: document.getElementById('achievements-earned-display'),
    gameOverTitle: document.getElementById('game-over-title'),
    gameOverMessage: document.getElementById('game-over-message'),
    quitToMainBtn: document.getElementById('quit-to-main-btn')
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // INITIALIZATION
  // ═══════════════════════════════════════════════════════════════════════
  init() {
    console.log('🎮 Initializing Accounts Wizard DX...');
    
    this.addEventListeners();
    this.initKeyboardControls();
    particleManager.init();
    powerUpsSystem.updateDisplay();
    
    this.showScreen('start');
    
    console.log('✅ Game initialized successfully!');
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // EVENT LISTENERS
  // ═══════════════════════════════════════════════════════════════════════
  addEventListeners() {
    // Game mode selection
    this.elements.gameModeButtons.forEach(btn => {
      btn.addEventListener('click', (e) => {
        soundManager.play('confirm');
        this.startQuiz(e.currentTarget.dataset.mode);
      });
    });
    
    // Answer buttons
    this.elements.answerButtons.forEach(btn => {
      btn.addEventListener('click', (e) => {
        if (!btn.disabled) {
          soundManager.play('select');
          this.checkAnswer(e.currentTarget.dataset.option);
        }
      });
    });
    
    // Game over screen
    this.elements.restartBtn.addEventListener('click', () => {
      soundManager.play('select');
      this.showScreen('start');
    });
    
    this.elements.viewHighScoresBtn.addEventListener('click', () => {
      soundManager.play('select');
      this.displayHighScores();
      this.showScreen('highScore');
    });
    
    this.elements.saveScoreBtn.addEventListener('click', () => {
      soundManager.play('confirm');
      this.saveHighScore();
    });
    
    // High score screen
    this.elements.backToMenuBtn.addEventListener('click', () => {
      soundManager.play('select');
      this.showScreen('start');
    });
    
    // Quit buttons
    this.elements.confirmQuitBtn.addEventListener('click', () => {
      this.quitToMainQuiz();
    });
    
    this.elements.quitToMenuBtn.addEventListener('click', () => {
      this.quitToMainMenu();
    });
    
    this.elements.quitToMainBtn.addEventListener('click', () => {
      this.quitToMainQuiz();
    });
    
    this.elements.cancelQuitBtn.addEventListener('click', () => {
      soundManager.play('select');
      this.elements.screens.quitConfirm.classList.add('hidden');
      this.resumeGame();
    });
    
    // Initials input - Enter key to save
    this.elements.initialsInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        this.elements.saveScoreBtn.click();
      }
    });
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // KEYBOARD CONTROLS - FIXED VERSION 🔧
  // ═══════════════════════════════════════════════════════════════════════
  initKeyboardControls() {
    window.addEventListener('keydown', (e) => {
      const activeScreen = document.querySelector('.screen:not(.hidden)');
      
      // ─────────────────────────────────────────────────────────────────
      // DURING QUIZ - Answer with A, B, C, D keys
      // ─────────────────────────────────────────────────────────────────
      if (activeScreen && activeScreen.id === 'quiz-screen' && !this.state.isPaused) {
        // Pause
        if (e.key.toLowerCase() === 'p') {
          e.preventDefault();
          this.pauseGame();
          return;
        }
        
        // Quit
        if (e.key.toLowerCase() === 'q') {
          e.preventDefault();
          this.pauseGame();
          this.elements.screens.quitConfirm.classList.remove('hidden');
          this.resetKeyboardNav();
          return;
        }
        
        // Answer keys (A, B, C, D)
        const key = e.key.toLowerCase();
        const button = Array.from(this.elements.answerButtons).find(
          btn => btn.dataset.key === key
        );
        
        if (button && !button.disabled) {
          e.preventDefault();
          soundManager.play('select');
          this.checkAnswer(button.dataset.option);
        }
        return;
      }
      
      // ─────────────────────────────────────────────────────────────────
      // DURING PAUSE - Handle quit confirm screen
      // ─────────────────────────────────────────────────────────────────
      if (this.state.isPaused && !this.elements.screens.quitConfirm.classList.contains('hidden')) {
        // Escape or P to cancel quit
        if (e.key === 'Escape' || e.key.toLowerCase() === 'p') {
          e.preventDefault();
          soundManager.play('select');
          this.elements.screens.quitConfirm.classList.add('hidden');
          this.resumeGame();
          return;
        }
        // Continue to normal navigation for quit screen
      } else if (this.state.isPaused) {
        // Regular pause screen
        if (e.key.toLowerCase() === 'p') {
          e.preventDefault();
          this.resumeGame();
          return;
        }
        if (e.key.toLowerCase() === 'q') {
          e.preventDefault();
          this.elements.screens.quitConfirm.classList.remove('hidden');
          this.resetKeyboardNav();
          return;
        }
        return;
      }
      
      // ─────────────────────────────────────────────────────────────────
      // MENU NAVIGATION - FIXED: Prevent page scrolling! 🔧
      // ─────────────────────────────────────────────────────────────────
      if (!activeScreen || activeScreen.id === 'quiz-screen') return;
      
      const navigableButtons = activeScreen.querySelectorAll('.retro-btn:not(:disabled)');
      if (navigableButtons.length === 0) return;
      
      let currentIndex = this.state.keyboardNavIndex;
      
      // Arrow Down - PREVENT DEFAULT SCROLLING! 🔧
      if (e.key === 'ArrowDown') {
        e.preventDefault(); // 🔧 THIS FIXES THE SCROLLING!
        soundManager.play('select');
        currentIndex = (currentIndex + 1) % navigableButtons.length;
      }
      // Arrow Up - PREVENT DEFAULT SCROLLING! 🔧
      else if (e.key === 'ArrowUp') {
        e.preventDefault(); // 🔧 THIS FIXES THE SCROLLING!
        soundManager.play('select');
        currentIndex = (currentIndex - 1 + navigableButtons.length) % navigableButtons.length;
      }
      // Enter - Select current button
      else if (e.key === 'Enter') {
        e.preventDefault();
        soundManager.play('confirm');
        navigableButtons[currentIndex].click();
        return;
      }
      // Escape - Back to previous screen (if applicable)
      else if (e.key === 'Escape') {
        e.preventDefault();
        soundManager.play('select');
        if (activeScreen.id === 'high-score-screen' || activeScreen.id === 'game-over-screen') {
          this.showScreen('start');
        }
        return;
      }
      
      this.updateKeyboardSelection(navigableButtons, currentIndex);
    });
    
    // ─────────────────────────────────────────────────────────────────
    // PREVENT SPACEBAR FROM SCROLLING PAGE 🔧
    // ─────────────────────────────────────────────────────────────────
    window.addEventListener('keydown', (e) => {
      if (e.key === ' ' || e.code === 'Space') {
        e.preventDefault();
      }
    });
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // KEYBOARD NAVIGATION HELPERS
  // ═══════════════════════════════════════════════════════════════════════
  updateKeyboardSelection(buttons, newIndex) {
    // Remove selection from all buttons
    buttons.forEach(btn => btn.classList.remove('selected-btn'));
    
    // Add selection to current button
    buttons[newIndex].classList.add('selected-btn');
    
    // Update index
    this.state.keyboardNavIndex = newIndex;
  },
  
  resetKeyboardNav() {
    setTimeout(() => {
      const activeScreen = document.querySelector('.screen:not(.hidden)');
      if (activeScreen) {
        const navigableButtons = activeScreen.querySelectorAll('.retro-btn:not(:disabled)');
        if (navigableButtons.length > 0) {
          this.updateKeyboardSelection(navigableButtons, 0);
        }
      }
    }, 50);
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // SCREEN MANAGEMENT
  // ═══════════════════════════════════════════════════════════════════════
  showScreen(screenName) {
    // Hide all screens except quit confirm (it's an overlay)
    Object.entries(this.elements.screens).forEach(([key, screen]) => {
      if (key !== 'quitConfirm') {
        screen.classList.add('hidden');
      }
    });
    
    // Show requested screen
    this.elements.screens[screenName].classList.remove('hidden');
    
    // Reset keyboard navigation
    this.resetKeyboardNav();
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // PAUSE/RESUME
  // ═══════════════════════════════════════════════════════════════════════
  pauseGame() {
    if (this.state.isGameOver) return;
    
    this.state.isPaused = true;
    clearInterval(this.state.timer);
    this.elements.pauseOverlay.classList.add('active');
    soundManager.play('select');
  },
  
  resumeGame() {
    this.state.isPaused = false;
    this.elements.pauseOverlay.classList.remove('active');
    this.elements.screens.quitConfirm.classList.add('hidden');
    this.runTimer();
    soundManager.play('select');
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // QUIT FUNCTIONS
  // ═══════════════════════════════════════════════════════════════════════
  quitToMainQuiz() {
    soundManager.play('wrong');
    window.location.href = CONFIG.MAIN_QUIZ_URL;
  },
  
  quitToMainMenu() {
    soundManager.play('select');
    clearInterval(this.state.timer);
    this.state.isGameOver = true;
    this.state.isPaused = false;
    this.elements.screens.quitConfirm.classList.add('hidden');
    this.elements.pauseOverlay.classList.remove('active');
    powerUpsSystem.reset();
    this.showScreen('start');
  },

  // ═══════════════════════════════════════════════════════════════════════
  // START QUIZ
  // ═══════════════════════════════════════════════════════════════════════
  startQuiz(mode) {
    console.log(`🎮 Starting ${mode} mode...`);
    
    // Reset state
    this.state = {
      mode: mode,
      score: 0,
      streak: 0,
      maxStreak: 0,
      correctAnswers: 0,
      totalAnswered: 0,
      currentQuestionIndex: 0,
      isGameOver: false,
      isPaused: false,
      questions: [],
      timer: null,
      timeLeft: 0,
      lives: 0,
      questionsAnswered: 0,
      bossMode: false,
      answerStartTime: 0,
      keyboardNavIndex: 0,
      bossQuestionsDefeated: 0,
      timeLeftInQuestion: 0
    };
    
    const modeConfig = CONFIG.GAME_MODES[mode];
    
    // Set up mode-specific settings
    this.elements.gameModeDisplay.textContent = modeConfig.name;
    
    // Set up lives if mode has them
    if (modeConfig.hasLives) {
      this.state.lives = modeConfig.lives;
      this.elements.livesContainer.style.display = 'block';
      this.updateLivesDisplay();
    } else {
      this.elements.livesContainer.style.display = 'none';
    }
    
    // Set up questions
    if (mode === 'bossRush') {
      // Boss Rush uses only boss questions
      this.state.questions = this.shuffle([...bossQuestions]);
    } else {
      // Other modes use regular questions
      this.state.questions = this.shuffle([...questionsPool]);
    }
    
    // Set up time attack mode
    if (mode === 'timeAttack') {
      this.state.timeLeft = modeConfig.totalTime;
    }
    
    // Reset power-ups
    powerUpsSystem.reset();
    
    // Update UI
    this.updateScoreUI();
    this.elements.answerFeedback.textContent = '';
    this.elements.bossWarning.classList.add('hidden');
    this.elements.quizArea.classList.remove('boss-mode');
    
    // Enable buttons
    this.enableButtons();
    
    // Show quiz screen and start first question
    this.showScreen('quiz');
    this.nextQuestion();
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // NEXT QUESTION
  // ═══════════════════════════════════════════════════════════════════════
  nextQuestion() {
    if (this.state.isGameOver) {
      this.endGame();
      return;
    }
    
    const modeConfig = CONFIG.GAME_MODES[this.state.mode];
    
    // ─────────────────────────────────────────────────────────────────
    // Check win condition for Boss Rush
    // ─────────────────────────────────────────────────────────────────
    if (this.state.mode === 'bossRush' && 
        this.state.bossQuestionsDefeated >= modeConfig.totalQuestions) {
      this.winGame();
      return;
    }
    
    // ─────────────────────────────────────────────────────────────────
    // Check if we should show a boss question (every 5 questions in non-boss modes)
    // ─────────────────────────────────────────────────────────────────
    if (this.state.mode !== 'bossRush' && 
        this.state.questionsAnswered > 0 && 
        this.state.questionsAnswered % 5 === 0) {
      this.state.bossMode = true;
      const bossQ = bossQuestions[Math.floor(Math.random() * bossQuestions.length)];
      this.state.questions[this.state.currentQuestionIndex] = bossQ;
    } else if (this.state.mode !== 'bossRush') {
      this.state.bossMode = false;
    } else {
      // In boss rush, all questions are boss questions
      this.state.bossMode = true;
    }
    
    // ─────────────────────────────────────────────────────────────────
    // Check end conditions for different modes
    // ─────────────────────────────────────────────────────────────────
    if (this.state.mode === 'classic' && 
        this.state.currentQuestionIndex >= modeConfig.totalQuestions) {
      this.endGame();
      return;
    }
    
    // Check if we ran out of questions (reshuffle for boss rush)
    if (this.state.currentQuestionIndex >= this.state.questions.length) {
      if (this.state.mode === 'bossRush') {
        this.state.questions = this.shuffle([...bossQuestions]);
        this.state.currentQuestionIndex = 0;
      } else {
        this.endGame();
        return;
      }
    }
    
    // ─────────────────────────────────────────────────────────────────
    // Display current question
    // ─────────────────────────────────────────────────────────────────
    const current = this.state.questions[this.state.currentQuestionIndex];
    
    // Update question number display
    let questionNumberText = `Q: ${this.state.questionsAnswered + 1}`;
    
    if (this.state.mode === 'classic') {
      questionNumberText = `LEVEL ${this.state.currentQuestionIndex + 1}/${modeConfig.totalQuestions}`;
    } else if (this.state.mode === 'bossRush') {
      questionNumberText = `BOSS ${this.state.bossQuestionsDefeated + 1}/${modeConfig.totalQuestions}`;
    }
    
    this.elements.questionNumber.textContent = questionNumberText;
    this.elements.questionText.textContent = current.q;
    
    // ─────────────────────────────────────────────────────────────────
    // Boss mode styling
    // ─────────────────────────────────────────────────────────────────
    if (this.state.bossMode) {
      this.elements.quizArea.classList.add('boss-mode');
      this.elements.questionText.classList.add('boss');
      this.elements.bossWarning.classList.remove('hidden');
      soundManager.play('boss');
    } else {
      this.elements.quizArea.classList.remove('boss-mode');
      this.elements.questionText.classList.remove('boss');
      this.elements.bossWarning.classList.add('hidden');
    }
    
    // Clear feedback
    this.elements.answerFeedback.textContent = '';
    
    // Enable buttons
    this.enableButtons();
    
    // Record when question started (for speed achievement)
    this.state.answerStartTime = Date.now();
    
    // Start timer
    this.startTimer();
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // TIMER SYSTEM
  // ═══════════════════════════════════════════════════════════════════════
  startTimer() {
    const modeConfig = CONFIG.GAME_MODES[this.state.mode];
    let timeForQuestion = modeConfig.timePerQuestion;
    
    // Apply time freeze power-up (doubles time)
    if (powerUpsSystem.active.timeFreeze) {
      timeForQuestion *= 2;
      powerUpsSystem.use('timeFreeze');
    }
    
    // Set time based on mode
    if (this.state.mode === 'timeAttack') {
      this.state.timeLeftInQuestion = timeForQuestion;
    } else {
      this.state.timeLeft = timeForQuestion;
      this.elements.timerBar.style.width = "100%";
      this.elements.timerBar.classList.remove('warning');
    }
    
    // Start the timer loop
    this.runTimer();
  },
  
  runTimer() {
    clearInterval(this.state.timer);
    
    const modeConfig = CONFIG.GAME_MODES[this.state.mode];
    
    if (this.state.mode === 'timeAttack') {
      // Time Attack: countdown from total time
      this.state.timer = setInterval(() => {
        if (this.state.isPaused) return;
        
        this.state.timeLeft -= 0.01;
        this.state.timeLeftInQuestion -= 0.01;
        
        // Update progress bar based on question time
        const questionTimePercent = (this.state.timeLeftInQuestion / modeConfig.timePerQuestion) * 100;
        this.elements.timerBar.style.width = `${questionTimePercent}%`;
        
        // Warning color when time is low
        if (questionTimePercent < 30) {
          this.elements.timerBar.classList.add('warning');
        }
        
        // Update question number to show total time left
        this.elements.questionNumber.textContent = `TIME: ${Math.ceil(this.state.timeLeft)}s`;
        
        // Check if question time ran out
        if (this.state.timeLeftInQuestion <= 0) {
          this.handleTimeout();
        }
        
        // Check if total time ran out
        if (this.state.timeLeft <= 0) {
          this.endGame();
        }
      }, 10);
    } else {
      // Other modes: countdown per question
      this.state.timer = setInterval(() => {
        if (this.state.isPaused) return;
        
        this.state.timeLeft -= 0.01;
        
        const percent = (this.state.timeLeft / modeConfig.timePerQuestion) * 100;
        this.elements.timerBar.style.width = `${percent}%`;
        
        // Warning color when time is low
        if (percent < 30) {
          this.elements.timerBar.classList.add('warning');
        }
        
        // Time's up!
        if (this.state.timeLeft <= 0) {
          this.handleTimeout();
        }
      }, 10);
    }
  },
  
  handleTimeout() {
    clearInterval(this.state.timer);
    soundManager.play('wrong');
    
    // Check if player has shield
    if (powerUpsSystem.active.shield) {
      this.elements.answerFeedback.textContent = "⚠ SHIELD PROTECTED YOU!";
      this.elements.answerFeedback.className = 'correct';
      powerUpsSystem.use('shield');
    } else {
      this.elements.answerFeedback.textContent = "⏰ TIME'S UP!";
      this.elements.answerFeedback.className = 'wrong';
      this.state.streak = 0;
      this.loseLife();
    }
    
    this.disableButtons();
    this.updateComboMeter();
    
    if (this.state.isGameOver) {
      setTimeout(() => this.endGame(), 1500);
    } else {
      this.state.currentQuestionIndex++;
      this.state.totalAnswered++; // Count timeout as answered
      setTimeout(() => this.nextQuestion(), 1500);
    }
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // CHECK ANSWER
  // ═══════════════════════════════════════════════════════════════════════
  checkAnswer(option) {
    // Stop timer
    clearInterval(this.state.timer);
    
    // Disable buttons to prevent double-clicking
    this.disableButtons();
    
    const current = this.state.questions[this.state.currentQuestionIndex];
    
    // Increment counters
    this.state.totalAnswered++;
    this.state.questionsAnswered++;
    
    // Calculate answer time for speed achievement
    const answerTime = (Date.now() - this.state.answerStartTime) / 1000;
    if (answerTime < 2) {
      achievementsSystem.check('speedDemon');
    }
    
    // Check if answer is correct
    if (option === current.a) {
      this.handleCorrectAnswer(current);
    } else {
      this.handleWrongAnswer(current.a);
    }
    
    // Update UI
    this.updateScoreUI();
    this.updateComboMeter();
    
    // Check for 20 questions achievement
    if (this.state.questionsAnswered >= 20) {
      achievementsSystem.check('survivor');
    }
    
    // Move to next question after delay
    if (!this.state.isGameOver) {
      this.state.currentQuestionIndex++;
      setTimeout(() => {
        if (!this.state.isGameOver) {
          this.nextQuestion();
        }
      }, 1500);
    } else {
      setTimeout(() => this.endGame(), 1500);
    }
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // HANDLE CORRECT ANSWER
  // ═══════════════════════════════════════════════════════════════════════
  handleCorrectAnswer(question) {
    soundManager.play('correct');
    
    // Increment streak
    this.state.streak++;
    this.state.correctAnswers++;
    
    // Update max streak
    if (this.state.streak > this.state.maxStreak) {
      this.state.maxStreak = this.state.streak;
    }
    
    // Increment boss counter if in boss rush
    if (this.state.mode === 'bossRush') {
      this.state.bossQuestionsDefeated++;
    }
    
    // ─────────────────────────────────────────────────────────────────
    // Calculate points
    // ─────────────────────────────────────────────────────────────────
    const timeBonus = Math.floor(this.state.timeLeft * CONFIG.POINTS.timeBonusMultiplier);
    const streakBonus = (this.state.streak - 1) * CONFIG.POINTS.streakBonus;
    const difficultyBonus = (question.difficulty || 1) * CONFIG.POINTS.difficultyMultiplier;
    const bossBonus = this.state.bossMode ? CONFIG.POINTS.bossBonus : 0;
    
    let pointsGained = CONFIG.POINTS.perCorrect + timeBonus + streakBonus + difficultyBonus + bossBonus;
    
    // Apply double points power-up
    if (powerUpsSystem.active.doublePoints) {
      pointsGained *= 2;
      powerUpsSystem.use('doublePoints');
    }
    
    // Add points to score
    this.state.score += pointsGained;
    
    // ─────────────────────────────────────────────────────────────────
    // Display feedback
    // ─────────────────────────────────────────────────────────────────
    this.elements.answerFeedback.innerHTML = `
      ${this.state.bossMode ? '👹 BOSS DEFEATED! ' : '✅ CORRECT! '}
      <span style="color:var(--color-yellow);">+${pointsGained}</span>
    `;
    this.elements.answerFeedback.className = 'correct';
    
    // ─────────────────────────────────────────────────────────────────
    // Particle effects
    // ─────────────────────────────────────────────────────────────────
    const rect = this.elements.questionText.getBoundingClientRect();
    const crtRect = document.getElementById('crt-screen').getBoundingClientRect();
    
    const particleX = rect.left - crtRect.left + rect.width / 2;
    const particleY = rect.top - crtRect.top + rect.height / 2;
    
    particleManager.createExplosion(
      particleX,
      particleY,
      '#00ff00',
      this.state.bossMode ? 100 : 50
    );
    
    particleManager.createText(
      particleX,
      particleY - 50,
      `+${pointsGained}`,
      '#ffb700'
    );
    
    // ─────────────────────────────────────────────────────────────────
    // Check achievements
    // ─────────────────────────────────────────────────────────────────
    if (this.state.correctAnswers === 1) {
      achievementsSystem.check('firstBlood');
    }
    if (this.state.streak === 5) {
      achievementsSystem.check('hotStreak');
    }
    if (this.state.streak === 10) {
      achievementsSystem.check('unstoppable');
    }
    if (this.state.score >= 10000) {
      achievementsSystem.check('centurion');
    }
    if (this.state.bossMode) {
      achievementsSystem.check('bossSlayer');
    }
    
    // ─────────────────────────────────────────────────────────────────
    // Random power-up drop (10% chance on 3+ streak)
    // ─────────────────────────────────────────────────────────────────
    if (this.state.streak >= 3 && Math.random() < 0.15) {
      powerUpsSystem.grant(powerUpsSystem.random());
    }
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // HANDLE WRONG ANSWER
  // ═══════════════════════════════════════════════════════════════════════
  handleWrongAnswer(correctAnswer) {
    // Check if player has shield
    if (powerUpsSystem.active.shield) {
      soundManager.play('powerup');
      this.elements.answerFeedback.innerHTML = `
        🛡 SHIELD SAVED YOU!<br>
        <span style="font-size: 10px;">(Correct: ${correctAnswer.toUpperCase()})</span>
      `;
      this.elements.answerFeedback.className = 'correct';
      powerUpsSystem.use('shield');
      return;
    }
    
    // Wrong answer
    soundManager.play('wrong');
    this.state.streak = 0;
    
    this.elements.answerFeedback.innerHTML = `
      ❌ WRONG!<br>
      <span style="font-size: 12px;">Answer: ${correctAnswer.toUpperCase()}</span>
    `;
    this.elements.answerFeedback.className = 'wrong';
    
    // Screen shake effect
    document.getElementById('crt-screen').classList.add('shake');
    setTimeout(() => {
      document.getElementById('crt-screen').classList.remove('shake');
    }, 500);
    
    // Lose life
    this.loseLife();
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // LOSE LIFE
  // ═══════════════════════════════════════════════════════════════════════
  loseLife() {
    const modeConfig = CONFIG.GAME_MODES[this.state.mode];
    
    // Sudden Death: instant game over
    if (this.state.mode === 'suddenDeath') {
      this.state.isGameOver = true;
      setTimeout(() => this.endGame(), 500);
      return;
    }
    
    // Modes with lives
    if (modeConfig.hasLives) {
      this.state.lives--;
      this.updateLivesDisplay();
      
      if (this.state.lives <= 0) {
        this.state.isGameOver = true;
        setTimeout(() => this.endGame(), 500);
      }
    }
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // UPDATE LIVES DISPLAY
  // ═══════════════════════════════════════════════════════════════════════
  updateLivesDisplay() {
    const modeConfig = CONFIG.GAME_MODES[this.state.mode];
    const maxLives = modeConfig.lives || 3;
    
    const hearts = '♥'.repeat(this.state.lives) + 
                   '♡'.repeat(Math.max(0, maxLives - this.state.lives));
    
    this.elements.lives.textContent = hearts;
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // UPDATE COMBO METER
  // ═══════════════════════════════════════════════════════════════════════
  updateComboMeter() {
    if (this.state.streak >= 3) {
      this.elements.comboMeter.classList.add('active');
      this.elements.comboDisplay.textContent = `x${this.state.streak}`;
    } else {
      this.elements.comboMeter.classList.remove('active');
    }
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // WIN GAME (for Boss Rush completion)
  // ═══════════════════════════════════════════════════════════════════════
  winGame() {
    this.state.isGameOver = true;
    clearInterval(this.state.timer);
    soundManager.play('win');
    
    // Champion achievement
    achievementsSystem.check('champion');
    
    // Customize the end screen for a win
    this.elements.gameOverTitle.textContent = "🎉 VICTORY! 🎉";
    this.elements.gameOverTitle.style.color = 'var(--color-yellow)';
    this.elements.gameOverTitle.style.textShadow = '0 0 30px var(--color-yellow)';
    this.elements.gameOverMessage.innerHTML = `
      <span style="color: var(--color-green);">
        You have defeated all ${CONFIG.GAME_MODES.bossRush.totalQuestions} bosses!<br>
        You are the ULTIMATE Accounts Wizard! 🧙‍♂️
      </span>
    `;
    
    // Massive particle explosion
    const rect = this.elements.questionText.getBoundingClientRect();
    const crtRect = document.getElementById('crt-screen').getBoundingClientRect();
    
    const particleX = rect.left - crtRect.left + rect.width / 2;
    const particleY = rect.top - crtRect.top + rect.height / 2;
    
    for (let i = 0; i < 5; i++) {
      setTimeout(() => {
        particleManager.createExplosion(particleX, particleY, '#ffb700', 100);
      }, i * 200);
    }
    
    this.showEndScreen();
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // END GAME (game over)
  // ═══════════════════════════════════════════════════════════════════════
  endGame() {
    this.state.isGameOver = true;
    clearInterval(this.state.timer);
    soundManager.play('gameOver');
    
    // Customize the end screen for a loss
    this.elements.gameOverTitle.textContent = "GAME OVER";
    this.elements.gameOverTitle.style.color = 'var(--color-red)';
    this.elements.gameOverTitle.style.textShadow = '0 0 20px var(--color-red)';
    
    // Set message based on mode
    const modeConfig = CONFIG.GAME_MODES[this.state.mode];
    let message = "";
    
    if (this.state.mode === 'suddenDeath') {
      message = "One mistake was all it took...";
    } else if (this.state.mode === 'timeAttack') {
      message = "Time's up! You survived as long as you could.";
    } else if (this.state.mode === 'bossRush') {
      message = `You defeated ${this.state.bossQuestionsDefeated} out of ${modeConfig.totalQuestions} bosses.`;
    } else if (this.state.mode === 'classic') {
      if (this.state.currentQuestionIndex >= modeConfig.totalQuestions) {
        message = "You completed all questions!";
      } else {
        message = "Better luck next time!";
      }
    }
    
    this.elements.gameOverMessage.innerHTML = `
      <span style="color: var(--color-cyan);">${message}</span>
    `;
    
    this.showEndScreen();
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // SHOW END SCREEN
  // ═══════════════════════════════════════════════════════════════════════
  showEndScreen() {
    // Check perfectionist achievement
    if (this.state.totalAnswered > 0 && 
        this.state.correctAnswers === this.state.totalAnswered) {
      achievementsSystem.check('perfectionist');
    }
    
    // Calculate accuracy
    const accuracy = this.state.totalAnswered > 0
      ? Math.round((this.state.correctAnswers / this.state.totalAnswered) * 100)
      : 0;
    
    // Update final score display
    this.elements.finalScore.textContent = this.formatScore(this.state.score, 6);
    this.elements.maxStreakDisplay.textContent = this.state.maxStreak;
    this.elements.accuracyDisplay.textContent = accuracy + '%';
    
    // Display achievements
    const unlockedCount = Object.values(achievementsSystem.achievements)
      .filter(a => a.unlocked).length;
    const totalCount = Object.keys(achievementsSystem.achievements).length;
    
    this.elements.achievementsEarnedDisplay.innerHTML = `
      <div class="mt-2" style="color: var(--color-yellow);">
        🏆 Achievements: ${unlockedCount}/${totalCount}
      </div>
    `;
    
    // Show game over screen
    this.showScreen('gameOver');
    
    // Check if this is a high score
    const highScores = this.getHighScores();
    const isHighScore = highScores.length < 10 || 
                       this.state.score > highScores[highScores.length - 1].score;
    
    if (isHighScore && this.state.score > 0) {
      this.elements.newHighScoreSection.classList.remove('hidden');
      this.elements.initialsInput.value = '';
      this.elements.initialsInput.focus();
      this.elements.gameOverControls.classList.add('hidden');
    } else {
      this.elements.newHighScoreSection.classList.add('hidden');
      this.elements.gameOverControls.classList.remove('hidden');
    }
    
    this.resetKeyboardNav();
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // HIGH SCORE MANAGEMENT
  // ═══════════════════════════════════════════════════════════════════════
  getHighScores() {
    const scoresJSON = localStorage.getItem(CONFIG.STORAGE_KEY);
    return scoresJSON ? JSON.parse(scoresJSON) : [];
  },
  
  saveHighScore() {
    const initials = this.elements.initialsInput.value.toUpperCase().trim() || 'AAA';
    
    // Validate initials (3 characters max)
    const validInitials = initials.substring(0, 3).padEnd(3, 'A');
    
    const newScore = {
      name: validInitials,
      score: this.state.score,
      mode: this.state.mode,
      accuracy: this.state.totalAnswered > 0
        ? Math.round((this.state.correctAnswers / this.state.totalAnswered) * 100)
        : 0,
      maxStreak: this.state.maxStreak,
      date: new Date().toISOString()
    };
    
    // Get existing scores
    let scores = this.getHighScores();
    
    // Add new score
    scores.push(newScore);
    
    // Sort by score (descending)
    scores.sort((a, b) => b.score - a.score);
    
    // Keep only top 10
    scores = scores.slice(0, 10);
    
    // Save to localStorage
    localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(scores));
    
    // Hide input section
    this.elements.newHighScoreSection.classList.add('hidden');
    
    // Show high scores
    this.displayHighScores();
    this.showScreen('highScore');
  },
  
  displayHighScores() {
    const scores = this.getHighScores();
    this.elements.highScoreTable.innerHTML = '';
    
    if (scores.length === 0) {
      this.elements.highScoreTable.innerHTML = `
        <li style="justify-content: center; color: var(--color-cyan); opacity: 0.7;">
          NO SCORES YET - BE THE FIRST!
        </li>
      `;
      return;
    }
    
    // Mode abbreviations
    const modeNames = {
      'classic': 'CLASSIC',
      'timeAttack': 'TIME',
      'suddenDeath': 'SUDDEN',
      'bossRush': 'BOSS'
    };
    
    scores.forEach((score, index) => {
      const li = document.createElement('li');
      
      // Medal emojis for top 3
      let medal = '';
      if (index === 0) medal = '🥇';
      else if (index === 1) medal = '🥈';
      else if (index === 2) medal = '🥉';
      
      li.innerHTML = `
        <span>
          ${medal} ${index + 1}. ${score.name}
          <span style="font-size: 9px; opacity: 0.7; margin-left: 8px;">
            [${modeNames[score.mode] || '???'}]
          </span>
        </span>
        <span class="score">${this.formatScore(score.score, 6)}</span>
      `;
      
      this.elements.highScoreTable.appendChild(li);
    });
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // UI UPDATE FUNCTIONS
  // ═══════════════════════════════════════════════════════════════════════
  updateScoreUI() {
    this.elements.score.textContent = this.formatScore(this.state.score, 6);
    this.elements.streak.textContent = `x${this.state.streak}`;
  },
  
  disableButtons() {
    this.elements.answerButtons.forEach(btn => {
      btn.disabled = true;
      btn.style.opacity = '0.5';
    });
  },
  
  enableButtons() {
    this.elements.answerButtons.forEach(btn => {
      btn.disabled = false;
      btn.style.opacity = '1';
    });
  },
  
  // ═══════════════════════════════════════════════════════════════════════
  // UTILITY FUNCTIONS
  // ═══════════════════════════════════════════════════════════════════════
  shuffle(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  },
  
  formatScore(num, padding) {
    return String(num).padStart(padding, '0');
  }
};

// ═══════════════════════════════════════════════════════════════════════════
// KONAMI CODE EASTER EGG 🎮
// ═══════════════════════════════════════════════════════════════════════════
const konamiCode = {
  sequence: ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'],
  currentIndex: 0,
  
  init() {
    window.addEventListener('keydown', (e) => {
      if (e.key === this.sequence[this.currentIndex]) {
        this.currentIndex++;
        
        if (this.currentIndex === this.sequence.length) {
          this.activate();
          this.currentIndex = 0;
        }
      } else {
        this.currentIndex = 0;
      }
    });
  },
  
  activate() {
    console.log('🎮 KONAMI CODE ACTIVATED!');
    
    // Grant all power-ups
    powerUpsSystem.grant('shield');
    powerUpsSystem.grant('timeFreeze');
    powerUpsSystem.grant('doublePoints');
    
    // Add bonus points
    game.state.score += 1000;
    game.updateScoreUI();
    
    // Show achievement
    const popup = document.getElementById('achievement-popup');
    const text = document.getElementById('achievement-text');
    
    text.innerHTML = `
      <div style="font-size: 24px; margin-bottom: 10px;">🎮</div>
      <strong style="color: var(--color-yellow);">KONAMI CODE!</strong><br>
      <span style="font-size: 10px; color: var(--color-cyan);">
        All power-ups activated!<br>+1000 bonus points!
      </span>
    `;
    
    popup.classList.add('show');
    soundManager.play('achievement');
    
    setTimeout(() => {
      popup.classList.remove('show');
    }, 4000);
    
    // Epic particle explosion
    const canvas = document.getElementById('particle-canvas');
    for (let i = 0; i < 10; i++) {
      setTimeout(() => {
        particleManager.createExplosion(
          Math.random() * canvas.width,
          Math.random() * canvas.height,
          ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'][Math.floor(Math.random() * 6)],
          30
        );
      }, i * 100);
    }
  }
};

// ═══════════════════════════════════════════════════════════════════════════
// DEBUG HELPERS (for development)
// ═══════════════════════════════════════════════════════════════════════════
const debug = {
  // Add score for testing
  addScore(amount) {
    game.state.score += amount;
    game.updateScoreUI();
    console.log(`✅ Added ${amount} points. Total: ${game.state.score}`);
  },
  
  // Grant power-up for testing
  grantPowerUp(type) {
    powerUpsSystem.grant(type);
    console.log(`✅ Granted power-up: ${type}`);
  },
  
  // Skip to next question
  skipQuestion() {
    game.state.currentQuestionIndex++;
    game.nextQuestion();
    console.log(`✅ Skipped to question ${game.state.currentQuestionIndex + 1}`);
  },
  
  // Win current game
  winGame() {
    game.winGame();
    console.log(`✅ Game won!`);
  },
  
  // Clear high scores
  clearHighScores() {
    localStorage.removeItem(CONFIG.STORAGE_KEY);
    console.log(`✅ High scores cleared!`);
  },
  
  // Reset achievements
  resetAchievements() {
    Object.keys(achievementsSystem.achievements).forEach(key => {
      achievementsSystem.achievements[key].unlocked = false;
    });
    console.log(`✅ Achievements reset!`);
  },
  
  // Show all achievements (for testing)
  unlockAllAchievements() {
    Object.keys(achievementsSystem.achievements).forEach(key => {
      achievementsSystem.check(key);
    });
    console.log(`✅ All achievements unlocked!`);
  }
};

// Make debug available in console
window.gameDebug = debug;

// ═══════════════════════════════════════════════════════════════════════════
// INITIALIZE GAME ON PAGE LOAD
// ═══════════════════════════════════════════════════════════════════════════
document.addEventListener('DOMContentLoaded', () => {
  console.log(`
  ╔════════════════════════════════════════════════════════════╗
  ║                                                            ║
  ║         ACCOUNTS WIZARD DX - ARCADE EDITION v2.5          ║
  ║                                                            ║
  ║  🎮 Master the art of accounting classification!          ║
  ║  🏆 Compete for high scores!                              ║
  ║  ⚡ Unlock achievements!                                  ║
  ║                                                            ║
  ║  Debug commands available: window.gameDebug               ║
  ║                                                            ║
  ╚════════════════════════════════════════════════════════════╝
  `);
  
  // Initialize game
  game.init();
  
  // Initialize Konami code
  konamiCode.init();
  
  console.log('✅ Game ready! Press arrow keys to navigate, Enter to select.');
  console.log('💡 Try entering the Konami code: ↑↑↓↓←→←→BA');
});

// ═══════════════════════════════════════════════════════════════════════════
// SERVICE WORKER (Optional - for offline play)
// ═══════════════════════════════════════════════════════════════════════════
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    // Uncomment to enable offline play
    // navigator.serviceWorker.register('/sw.js')
    //   .then(reg => console.log('✅ Service Worker registered'))
    //   .catch(err => console.log('❌ Service Worker registration failed'));
  });
}

// ═══════════════════════════════════════════════════════════════════════════
// PREVENT CONTEXT MENU (right-click) for full arcade feel
// ═══════════════════════════════════════════════════════════════════════════
document.addEventListener('contextmenu', (e) => {
  e.preventDefault();
});

// ═══════════════════════════════════════════════════════════════════════════
// PREVENT TEXT SELECTION (for cleaner arcade experience)
// ═══════════════════════════════════════════════════════════════════════════
document.addEventListener('selectstart', (e) => {
  if (!e.target.matches('input, textarea')) {
    e.preventDefault();
  }
});

// ═══════════════════════════════════════════════════════════════════════════
// END OF SCRIPT
// ═══════════════════════════════════════════════════════════════════════════
console.log('📜 All scripts loaded successfully!');
</script>
</body>
</html>