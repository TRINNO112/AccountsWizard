<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trial Balance - Final Accounts Preparation | AccountsWizard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <link rel="stylesheet" href="main.css">
  <style>
    /* ============================================
       ROOT VARIABLES & RESET
    ============================================ */
    :root {
      --bg: #0b1020;
      --bg-2: #0f1733;
      --card: #111633;
      --muted: #b8c2ff;
      --brand: #7c4dff;
      --brand-2: #00e5ff;
      --accent: #ff7ac6;
      --text: #e9eefc;
      --success: #4caf50;
      --warning: #ff9800;
      --error: #f44336;
      --radius: 16px;
      --shadow: 0 18px 40px rgba(2,6,23,.55);
      --speed: 300ms;
    }

    * { 
      box-sizing: border-box; 
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      color: var(--text);
      background: linear-gradient(180deg, var(--bg), var(--bg-2));
      min-height: 100vh;
      padding: 10px;
      overflow-x: hidden;
      position: relative;
    }

    /* ============================================
       ANIMATED BACKGROUND (Mobile Optimized)
    ============================================ */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 20% 80%, rgba(124, 77, 255, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(0, 229, 255, 0.08) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    /* Particles - Reduced for mobile performance */
    .particle {
      position: fixed;
      pointer-events: none;
      opacity: 0.2;
      z-index: 0;
    }

    .particle:nth-child(1) {
      top: 10%;
      left: 10%;
      width: 40px;
      height: 40px;
      background: radial-gradient(circle, var(--brand) 0%, transparent 70%);
      animation: float1 20s infinite;
    }

    .particle:nth-child(2) {
      top: 70%;
      right: 10%;
      width: 30px;
      height: 30px;
      background: radial-gradient(circle, var(--brand-2) 0%, transparent 70%);
      animation: float2 25s infinite;
    }

    @keyframes float1 {
      0%, 100% { transform: translate(0, 0) scale(1); }
      50% { transform: translate(30px, -30px) scale(1.1); }
    }

    @keyframes float2 {
      0%, 100% { transform: translate(0, 0) scale(1); }
      50% { transform: translate(-30px, 30px) scale(0.9); }
    }

    /* ============================================
       HEADER & NAVIGATION
    ============================================ */
    .nav-header {
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      padding: 10px 15px; 
      background: var(--card); 
      border-radius: 12px;
      margin-bottom: 20px; 
      box-shadow: var(--shadow);
      position: relative;
      z-index: 1;
      animation: slideDown 0.6s ease-out;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .nav-header a {
      color: var(--muted); 
      text-decoration: none; 
      display: flex; 
      align-items: center;
      gap: 6px; 
      padding: 6px 12px; 
      border-radius: 8px; 
      transition: all var(--speed);
      font-size: 0.9rem;
    }

    .nav-header a:hover { 
      color: var(--text); 
      background: rgba(255,255,255,0.05);
    }

    header { 
      text-align: center; 
      padding: 20px 10px;
      position: relative;
      z-index: 1;
      animation: fadeIn 0.8s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .lesson-title {
      font-size: 1.8rem; 
      font-weight: 900;
      background: linear-gradient(90deg, #fff 0%, var(--accent) 50%, var(--brand-2) 100%);
      background-size: 200% auto;
      -webkit-background-clip: text; 
      -webkit-text-fill-color: transparent;
      animation: shineText 3s linear infinite;
      margin-bottom: 10px;
      line-height: 1.2;
    }

    @keyframes shineText {
      to { background-position: 200% center; }
    }

    .breadcrumb { 
      color: var(--muted); 
      font-size: 0.85rem;
    }

    .breadcrumb a { 
      color: inherit; 
      text-decoration: none;
      transition: color var(--speed);
    }

    .breadcrumb a:hover { 
      color: var(--text); 
    }

    /* ============================================
       MAIN CONTENT & SECTIONS
    ============================================ */
    main {
      position: relative;
      z-index: 1;
      max-width: 100%;
    }

    section {
      background: var(--card); 
      border-radius: var(--radius);
      padding: 20px 15px; 
      margin-bottom: 20px; 
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      animation: fadeInUp 0.8s ease-out;
      border: 1px solid rgba(255,255,255,0.05);
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    section h2 {
      margin: 0 0 15px 0; 
      font-size: 1.3rem;
      background: linear-gradient(90deg, #fff, var(--brand-2));
      -webkit-background-clip: text; 
      -webkit-text-fill-color: transparent;
      line-height: 1.3;
    }

    section p { 
      line-height: 1.6; 
      color: var(--muted);
      font-size: 0.95rem;
    }

    /* ============================================
       DEFINITION & NOTE BOXES
    ============================================ */
    .definition-box {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px 15px;
      border-radius: 12px;
      margin: 15px 0;
      border-left: 4px solid var(--brand);
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
      color: white;
      position: relative;
      overflow: hidden;
    }

    .definition-box h3 {
      margin: 0 0 12px 0;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .definition-box p {
      color: white !important;
      font-size: 0.95rem;
      line-height: 1.6;
      margin: 0;
    }

    .note-box {
      background: linear-gradient(135deg, rgba(0,229,255,0.1), rgba(0,229,255,0.05));
      padding: 15px;
      border-radius: 12px;
      margin: 15px 0;
      border-left: 4px solid var(--brand-2);
    }

    .note-box h4 {
      color: var(--brand-2);
      margin: 0 0 10px 0;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .note-box p, .note-box ul {
      color: var(--muted);
      font-size: 0.9rem;
      line-height: 1.6;
      margin: 0;
    }

    .note-box ul {
      padding-left: 20px;
      margin-top: 8px;
    }

    .error-box {
      background: linear-gradient(135deg, rgba(244,67,54,0.1), rgba(244,67,54,0.05));
      padding: 15px;
      border-radius: 12px;
      margin: 15px 0;
      border-left: 4px solid var(--error);
    }

    .error-box h4 {
      color: var(--error);
      margin: 0 0 10px 0;
      font-size: 1rem;
    }

    /* ============================================
       OBJECTIVES GRID (Mobile Optimized)
    ============================================ */
    .objectives-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin: 20px 0;
    }

    .objective-card {
      background: rgba(255,255,255,0.02);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
      border: 2px solid rgba(255,255,255,0.1);
      position: relative;
      overflow: hidden;
    }

    .objective-card:hover {
      transform: translateY(-3px);
      border-color: var(--brand-2);
      box-shadow: 0 10px 30px rgba(0,229,255,0.2);
    }

    .objective-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      color: white;
      background: linear-gradient(135deg, var(--brand), var(--brand-2));
      margin-bottom: 12px;
    }

    .objective-title {
      color: var(--text);
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .objective-desc {
      color: var(--muted);
      line-height: 1.5;
      font-size: 0.85rem;
    }

    /* ============================================
       TABLES (Mobile Optimized)
    ============================================ */
    .table-wrapper {
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin: 20px 0;
      border-radius: 12px;
      background: rgba(255,255,255,0.02);
    }

    .table-scroll-hint {
      display: block;
      text-align: center;
      color: var(--muted);
      font-size: 0.75rem;
      margin-top: 5px;
      font-style: italic;
    }

    .trial-balance-table,
    .game-trial-balance,
    .calculator-table {
      width: 100%;
      min-width: 500px;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    .trial-balance-table th,
    .trial-balance-table td,
    .game-trial-balance th,
    .game-trial-balance td,
    .calculator-table th,
    .calculator-table td {
      padding: 10px 8px;
      text-align: left;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .trial-balance-table th,
    .game-trial-balance th,
    .calculator-table th {
      background: rgba(124,77,255,0.2);
      font-weight: 700;
      color: var(--brand-2);
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    .trial-balance-table tr:hover,
    .game-trial-balance tr:hover {
      background: rgba(255,255,255,0.05);
    }

    .debit-total, .credit-total {
      background: rgba(76,175,80,0.1);
      font-weight: bold;
      color: var(--success);
    }

    /* ============================================
       PRACTICAL CARDS (Mobile Optimized)
    ============================================ */
    .practical-card {
      background: rgba(255,255,255,0.02);
      border-radius: 12px;
      padding: 20px 15px;
      margin: 15px 0;
      transition: all 0.3s ease;
      border: 2px solid rgba(255,255,255,0.1);
    }

    .practical-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
    }

    .practical-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      color: white;
      background: linear-gradient(135deg, var(--brand-2), var(--accent));
      flex-shrink: 0;
    }

    .practical-title {
      color: var(--text);
      font-size: 1.1rem;
      font-weight: 700;
      margin: 0;
      line-height: 1.3;
    }

    .view-solution-btn {
      background: linear-gradient(135deg, var(--brand-2), var(--brand));
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      margin-top: 15px;
      width: 100%;
      font-weight: 600;
    }

    .view-solution-btn:hover {
      transform: scale(1.02);
      box-shadow: 0 5px 20px rgba(0,229,255,0.4);
    }

    .solution {
      display: none;
      background: rgba(124,77,255,0.05);
      border-radius: 12px;
      padding: 20px 15px;
      margin-top: 15px;
      border: 1px solid rgba(124,77,255,.2);
    }

    .solution.active {
      display: block;
      animation: expandDown 0.5s ease;
    }

    @keyframes expandDown {
      from { opacity: 0; max-height: 0; }
      to { opacity: 1; max-height: 5000px; }
    }

        /* ============================================
       GAME STYLES (Mobile Optimized)
    ============================================ */
    .game-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-top: 20px;
    }

    .transactions-panel,
    .trial-balance-panel {
      background: rgba(255,255,255,0.02);
      border-radius: 12px;
      padding: 20px 15px;
      border: 2px solid rgba(255,255,255,0.1);
    }

    .transactions-panel h3,
    .trial-balance-panel h3 {
      color: var(--brand-2);
      margin: 0 0 15px 0;
      font-size: 1.1rem;
    }

    .transactions-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 400px;
      overflow-y: auto;
      padding-right: 5px;
    }

    .transaction-item {
      background: linear-gradient(135deg, rgba(124,77,255,0.1), rgba(0,229,255,0.1));
      padding: 12px;
      border-radius: 10px;
      cursor: grab;
      transition: all 0.3s;
      border: 2px solid transparent;
      touch-action: none;
    }

    .transaction-item:hover {
      transform: translateY(-2px);
      border-color: var(--brand-2);
      box-shadow: 0 5px 15px rgba(0,229,255,0.3);
    }

    .transaction-item.dragging {
      opacity: 0.5;
      cursor: grabbing;
    }

    .transaction-amount {
      font-size: 1.1rem;
      font-weight: bold;
      color: var(--brand-2);
      font-family: monospace;
    }

    .transaction-account {
      color: var(--muted);
      margin-top: 4px;
      font-size: 0.85rem;
    }

    .drop-zone {
      min-height: 36px;
      background: rgba(255,255,255,0.02);
      border: 2px dashed rgba(255,255,255,0.2);
      border-radius: 6px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--muted);
      font-family: monospace;
      font-size: 0.8rem;
      padding: 5px;
    }

    .drop-zone.drag-over {
      background: rgba(0,229,255,0.1);
      border-color: var(--brand-2);
      transform: scale(1.02);
    }

    .drop-zone.has-value {
      background: rgba(124,77,255,0.1);
      border: 2px solid var(--brand);
      color: var(--text);
      font-weight: bold;
    }

    .drop-zone.incorrect {
      animation: shake 0.5s;
      background: rgba(244,67,54,0.2) !important;
      border-color: var(--error) !important;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    .game-controls {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .hint-btn, .reset-btn, .check-btn {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
    }

    .hint-btn {
      background: linear-gradient(135deg, var(--warning), #ffb74d);
      color: white;
    }

    .reset-btn {
      background: linear-gradient(135deg, #666, #888);
      color: white;
    }

    .check-btn {
      background: linear-gradient(135deg, var(--brand-2), var(--brand));
      color: white;
      flex: 1;
      min-width: 120px;
    }

    .game-feedback {
      margin-top: 15px;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      display: none;
      font-size: 0.95rem;
    }

    .game-feedback.success {
      background: linear-gradient(135deg, rgba(76,175,80,0.2), rgba(76,175,80,0.1));
      border: 2px solid var(--success);
      color: var(--success);
    }

    .game-feedback.error {
      background: linear-gradient(135deg, rgba(244,67,54,0.2), rgba(244,67,54,0.1));
      border: 2px solid var(--error);
      color: var(--error);
    }

    .game-feedback.hint {
      background: linear-gradient(135deg, rgba(255,152,0,0.2), rgba(255,152,0,0.1));
      border: 2px solid var(--warning);
      color: var(--warning);
    }

    #confetti-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
    }

    /* ============================================
       CALCULATOR STYLES (Mobile Optimized)
    ============================================ */
    .calculator-container {
      background: rgba(255,255,255,0.02);
      border-radius: 12px;
      padding: 20px 15px;
      border: 2px solid rgba(255,255,255,0.1);
      margin-top: 20px;
    }

    .calculator-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .add-row-btn, .clear-all-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
    }

    .add-row-btn {
      background: linear-gradient(135deg, var(--success), #81c784);
      color: white;
    }

    .clear-all-btn {
      background: linear-gradient(135deg, var(--error), #e57373);
      color: white;
    }

    .calculator-table input {
      width: 100%;
      padding: 6px 8px;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 6px;
      color: var(--text);
      font-size: 0.85rem;
      transition: all 0.3s;
    }

    .calculator-table input:focus {
      outline: none;
      border-color: var(--brand-2);
      background: rgba(0,229,255,0.05);
    }

    .calculator-table input:invalid {
      border-color: var(--error);
    }

    .remove-row-btn {
      background: rgba(244,67,54,0.2);
      border: 2px solid var(--error);
      color: var(--error);
      padding: 4px 8px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.8rem;
    }

    .remove-row-btn:hover {
      background: var(--error);
      color: white;
    }

    .calculator-totals {
      background: rgba(255,255,255,0.05);
      font-weight: bold;
    }

    .calculator-totals td {
      text-align: center;
      font-family: monospace;
      font-size: 1rem;
    }

    .balance-status {
      margin-top: 15px;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      transition: all 0.3s;
    }

    .balance-status.balanced {
      background: linear-gradient(135deg, rgba(76,175,80,0.2), rgba(76,175,80,0.1));
      border: 2px solid var(--success);
    }

    .balance-status.not-balanced {
      background: linear-gradient(135deg, rgba(244,67,54,0.2), rgba(244,67,54,0.1));
      border: 2px solid var(--error);
    }

    .status-text {
      font-size: 1rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      flex-direction: column;
    }

    .balance-status.balanced .status-text {
      color: var(--success);
    }

    .balance-status.not-balanced .status-text {
      color: var(--error);
    }

    /* ============================================
       RESPONSIVE BREAKPOINTS
    ============================================ */
    
    /* Tablet and up */
    @media (min-width: 768px) {
      body {
        padding: 20px;
      }

      .lesson-title {
        font-size: 2.5rem;
      }

      section {
        padding: 30px 25px;
      }

      section h2 {
        font-size: 1.5rem;
      }

      .objectives-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
      }

      .game-container {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 30px;
      }

      .practical-header {
        flex-direction: row;
      }

      .view-solution-btn {
        width: auto;
      }

      .game-controls {
        flex-wrap: nowrap;
      }

      .calculator-controls {
        flex-wrap: nowrap;
      }
    }

    /* Desktop and up */
    @media (min-width: 1024px) {
      main {
        max-width: 1200px;
        margin: 0 auto;
      }

      .objectives-grid {
        grid-template-columns: repeat(3, 1fr);
      }

      .nav-header {
        padding: 12px 24px;
      }

      header {
        padding: 30px 20px;
      }

      .table-scroll-hint {
        display: none;
      }
    }

    /* Large Desktop */
    @media (min-width: 1440px) {
      main {
        max-width: 1400px;
      }
    }

    /* Reduced Motion Support */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>
<body>
  <!-- Floating Particles -->
  <div class="particle"></div>
  <div class="particle"></div>

  <!-- Navigation -->
  <div class="nav-header">
    <a href="../index.html"><i class="fa-solid fa-house"></i><span>Home</span></a>
    <a href="../lessons.html"><i class="fa-solid fa-book"></i><span>All Lessons</span></a>
  </div>

  <!-- Header -->
  <header>
    <h1 class="lesson-title">Trial Balance - Final Accounts Preparation</h1>
    <div class="breadcrumb">
      <a href="../index.html">Home</a> / 
      <a href="../lessons.html">Lessons</a> / 
      Trial Balance
    </div>
  </header>

  <main>
        <!-- Introduction Section -->
    <section>
      <h2>What is a Trial Balance?</h2>
      
      <div class="definition-box">
        <h3>
          <i class="fas fa-balance-scale"></i>
          Definition
        </h3>
        <p>
          A <strong>Trial Balance</strong> is a statement that shows the list of all ledger accounts with their debit or credit balances at a particular date. It is prepared to verify the arithmetical accuracy of ledger postings and to ensure that total debits equal total credits.
        </p>
      </div>

      <p style="margin-top: 20px;">
        The Trial Balance acts as a bridge between the books of accounts and the final accounts. It provides a consolidated view of all account balances and helps accountants detect errors before preparing financial statements. While it ensures mathematical accuracy, it does not guarantee that all transactions have been recorded correctly or in the proper accounts.
      </p>

      <div class="note-box">
        <h4><i class="fas fa-lightbulb"></i> Key Point</h4>
        <p>
          The fundamental principle of Trial Balance: <strong>Total Debit Balance = Total Credit Balance</strong>. This equality is based on the double-entry system where every debit has a corresponding credit. If the Trial Balance doesn't tally, it indicates errors in recording or posting transactions.
        </p>
      </div>
    </section>

    <!-- Objectives Section -->
    <section>
      <h2>Objectives of Trial Balance</h2>
      <p style="margin-bottom: 20px;">
        Preparing a Trial Balance serves multiple crucial purposes in the accounting process:
      </p>

      <div class="objectives-grid">
        <div class="objective-card">
          <div class="objective-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="objective-title">Verify Arithmetical Accuracy</div>
          <div class="objective-desc">
            Ensures that total debits equal total credits, confirming that the double-entry system has been followed correctly in recording transactions.
          </div>
        </div>

        <div class="objective-card">
          <div class="objective-icon">
            <i class="fas fa-bug"></i>
          </div>
          <div class="objective-title">Detect Errors</div>
          <div class="objective-desc">
            Helps identify mathematical and posting errors such as wrong totaling, incorrect balancing, or posting to the wrong side of an account.
          </div>
        </div>

        <div class="objective-card">
          <div class="objective-icon">
            <i class="fas fa-file-invoice"></i>
          </div>
          <div class="objective-title">Basis for Final Accounts</div>
          <div class="objective-desc">
            Provides the foundation for preparing Trading Account, Profit & Loss Account, and Balance Sheet by consolidating all ledger balances.
          </div>
        </div>

        <div class="objective-card">
          <div class="objective-icon">
            <i class="fas fa-list-check"></i>
          </div>
          <div class="objective-title">Summary of Accounts</div>
          <div class="objective-desc">
            Presents a comprehensive summary of all ledger accounts in one place, making it easier to review the financial position.
          </div>
        </div>

        <div class="objective-card">
          <div class="objective-icon">
            <i class="fas fa-clipboard-check"></i>
          </div>
          <div class="objective-title">Facilitates Comparison</div>
          <div class="objective-desc">
            Enables comparison of current period balances with previous periods to identify trends and make informed business decisions.
          </div>
        </div>

        <div class="objective-card">
          <div class="objective-icon">
            <i class="fas fa-shield-alt"></i>
          </div>
          <div class="objective-title">Internal Control</div>
          <div class="objective-desc">
            Acts as an internal control mechanism by regularly checking the accuracy of accounting records and reducing the risk of fraud.
          </div>
        </div>
      </div>
    </section>

    <!-- Format Section -->
    <section>
      <h2>Format of Trial Balance</h2>
      <p style="margin-bottom: 20px;">
        A Trial Balance can be prepared in two formats: <strong>Horizontal Format</strong> (most common) and <strong>Vertical Format</strong>. Below is the standard horizontal format:
      </p>

      <div class="table-wrapper">
        <table class="trial-balance-table">
          <thead>
            <tr>
              <th>S.No.</th>
              <th>Particulars</th>
              <th>L.F.</th>
              <th>Debit (₹)</th>
              <th>Credit (₹)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>Cash Account</td>
              <td>1</td>
              <td style="text-align: right;">XX,XXX</td>
              <td style="text-align: right;">-</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Bank Account</td>
              <td>2</td>
              <td style="text-align: right;">XX,XXX</td>
              <td style="text-align: right;">-</td>
            </tr>
            <tr>
              <td>3</td>
              <td>Purchases Account</td>
              <td>5</td>
              <td style="text-align: right;">XX,XXX</td>
              <td style="text-align: right;">-</td>
            </tr>
            <tr>
              <td>4</td>
              <td>Sales Account</td>
              <td>8</td>
              <td style="text-align: right;">-</td>
              <td style="text-align: right;">XX,XXX</td>
            </tr>
            <tr>
              <td>5</td>
              <td>Capital Account</td>
              <td>10</td>
              <td style="text-align: right;">-</td>
              <td style="text-align: right;">XX,XXX</td>
            </tr>
            <tr>
              <td>6</td>
              <td>Debtors</td>
              <td>12</td>
              <td style="text-align: right;">XX,XXX</td>
              <td style="text-align: right;">-</td>
            </tr>
            <tr>
              <td>7</td>
              <td>Creditors</td>
              <td>15</td>
              <td style="text-align: right;">-</td>
              <td style="text-align: right;">XX,XXX</td>
            </tr>
            <tr class="debit-total">
              <td colspan="3" style="text-align: right;"><strong>Total:</strong></td>
              <td style="text-align: right;"><strong>X,XX,XXX</strong></td>
              <td style="text-align: right;"><strong>X,XX,XXX</strong></td>
            </tr>
          </tbody>
        </table>
        <span class="table-scroll-hint">← Scroll horizontally →</span>
      </div>

      <div class="note-box">
        <h4><i class="fas fa-info-circle"></i> Components of Trial Balance</h4>
        <ul>
          <li><strong>Serial Number:</strong> Sequential numbering of accounts</li>
          <li><strong>Particulars:</strong> Name of the ledger account</li>
          <li><strong>L.F. (Ledger Folio):</strong> Page number of the account in the ledger</li>
          <li><strong>Debit Balance:</strong> Accounts with debit balance (Assets, Expenses, Drawings)</li>
          <li><strong>Credit Balance:</strong> Accounts with credit balance (Liabilities, Capital, Income)</li>
        </ul>
      </div>
    </section>

    <!-- Rules for Debit and Credit -->
    <section>
      <h2>Rules for Debit and Credit in Trial Balance</h2>
      
      <div class="objectives-grid">
        <div class="objective-card">
          <div class="objective-icon" style="background: linear-gradient(135deg, #4caf50, #81c784);">
            <i class="fas fa-arrow-left"></i>
          </div>
          <div class="objective-title">Accounts with DEBIT Balance</div>
          <div class="objective-desc">
            <ul style="list-style: none; padding: 0; margin: 10px 0 0 0; line-height: 1.8;">
              <li>✓ All Assets (Cash, Bank, Stock, Furniture, etc.)</li>
              <li>✓ All Expenses (Rent, Salary, Wages, etc.)</li>
              <li>✓ All Losses (Loss on Sale of Assets, Bad Debts)</li>
              <li>✓ Drawings/Withdrawals by Owner</li>
              <li>✓ Debtors/Accounts Receivable</li>
              <li>✓ Purchases Account</li>
            </ul>
          </div>
        </div>

        <div class="objective-card">
          <div class="objective-icon" style="background: linear-gradient(135deg, #f44336, #e57373);">
            <i class="fas fa-arrow-right"></i>
          </div>
          <div class="objective-title">Accounts with CREDIT Balance</div>
          <div class="objective-desc">
            <ul style="list-style: none; padding: 0; margin: 10px 0 0 0; line-height: 1.8;">
              <li>✓ All Liabilities (Loans, Bank Overdraft, etc.)</li>
              <li>✓ Capital Account</li>
              <li>✓ All Incomes & Revenues (Sales, Commission, etc.)</li>
              <li>✓ All Gains (Profit on Sale of Assets)</li>
              <li>✓ Creditors/Accounts Payable</li>
              <li>✓ Sales Account</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Errors Detected and Not Detected -->
    <section>
      <h2>Errors: What Trial Balance Can and Cannot Detect</h2>
      
      <div class="objectives-grid">
        <div class="objective-card" style="border-color: var(--success);">
          <div class="objective-icon" style="background: linear-gradient(135deg, var(--success), #81c784);">
            <i class="fas fa-check-double"></i>
          </div>
          <div class="objective-title" style="color: var(--success);">Errors DETECTED by Trial Balance</div>
          <div class="objective-desc">
            <ol style="line-height: 1.8; padding-left: 20px; margin: 10px 0 0 0;">
              <li><strong>Error of Totaling:</strong> Wrong addition in ledger accounts</li>
              <li><strong>Error of Balancing:</strong> Incorrect calculation of account balance</li>
              <li><strong>Error of Posting:</strong> Wrong amount posted or posted to wrong side</li>
              <li><strong>Error of Omission (Partial):</strong> One side of entry posted, other side omitted</li>
              <li><strong>Single Entry:</strong> Only one aspect recorded instead of double entry</li>
            </ol>
          </div>
        </div>

        <div class="objective-card" style="border-color: var(--error);">
          <div class="objective-icon" style="background: linear-gradient(135deg, var(--error), #e57373);">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="objective-title" style="color: var(--error);">Errors NOT DETECTED by Trial Balance</div>
          <div class="objective-desc">
            <ol style="line-height: 1.8; padding-left: 20px; margin: 10px 0 0 0;">
              <li><strong>Error of Omission (Complete):</strong> Transaction completely omitted from books</li>
              <li><strong>Error of Commission:</strong> Posting to wrong account (e.g., Ram instead of Shyam)</li>
              <li><strong>Error of Principle:</strong> Capital expenditure treated as revenue or vice versa</li>
              <li><strong>Compensating Errors:</strong> Two or more errors that cancel each other out</li>
              <li><strong>Error of Original Entry:</strong> Wrong amount recorded in all books</li>
            </ol>
          </div>
        </div>
      </div>

      <div class="error-box">
        <h4><i class="fas fa-exclamation-circle"></i> Important Note</h4>
        <p style="color: var(--muted); margin: 0;">
          A balanced Trial Balance does NOT guarantee 100% accuracy. It only confirms mathematical accuracy. The errors that don't affect the agreement of Trial Balance can still exist and must be detected through other means like careful review and reconciliation.
        </p>
      </div>
    </section>

        <!-- TYPE 1: Preparation Questions -->
    <section>
      <h2>Practice Questions: Prepare Trial Balance</h2>
      <p style="margin-bottom: 20px;">
        In these questions, you'll be given transactions and need to prepare a complete Trial Balance. Remember to identify each account type and place it on the correct side.
      </p>

      <!-- Question 1 -->
      <div class="practical-card">
        <div class="practical-header">
          <div class="practical-icon">1</div>
          <div>
            <h3 class="practical-title">Question 1: Basic Business Transactions</h3>
            <p style="color: var(--muted); margin: 5px 0 0 0; font-size: 0.85rem;">Prepare Trial Balance as on 31st March 2024</p>
          </div>
        </div>

        <div style="color: var(--muted); line-height: 1.8; margin: 20px 0; font-size: 0.9rem;">
          <strong>Balances as on 31st March 2024:</strong>
          <ol style="margin: 10px 0; padding-left: 20px;">
            <li>Capital: ₹2,00,000</li>
            <li>Cash in Hand: ₹35,000</li>
            <li>Bank Balance: ₹85,000</li>
            <li>Furniture: ₹45,000</li>
            <li>Stock: ₹60,000</li>
            <li>Debtors: ₹75,000</li>
            <li>Creditors: ₹40,000</li>
            <li>Purchases: ₹1,20,000</li>
            <li>Sales: ₹1,80,000</li>
            <li>Rent Paid: ₹24,000</li>
            <li>Salary Paid: ₹36,000</li>
          </ol>
        </div>

        <button class="view-solution-btn" onclick="toggleSolution('q1', event)">View Solution</button>

        <div class="solution" id="q1-solution">
          <h4 style="color: var(--brand-2); margin-bottom: 15px; font-size: 1rem;">Solution: Trial Balance as on 31st March 2024</h4>
          
          <div class="table-wrapper">
            <table class="trial-balance-table">
              <thead>
                <tr>
                  <th>S.No.</th>
                  <th>Particulars</th>
                  <th>Debit (₹)</th>
                  <th>Credit (₹)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td>Capital Account</td>
                  <td style="text-align: right;">-</td>
                  <td style="text-align: right;">2,00,000</td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>Cash in Hand</td>
                  <td style="text-align: right;">35,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>3</td>
                  <td>Bank Account</td>
                  <td style="text-align: right;">85,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>4</td>
                  <td>Furniture</td>
                  <td style="text-align: right;">45,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>5</td>
                  <td>Stock</td>
                  <td style="text-align: right;">60,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>6</td>
                  <td>Debtors</td>
                  <td style="text-align: right;">75,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>7</td>
                  <td>Creditors</td>
                  <td style="text-align: right;">-</td>
                  <td style="text-align: right;">40,000</td>
                </tr>
                <tr>
                  <td>8</td>
                  <td>Purchases</td>
                  <td style="text-align: right;">1,20,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>9</td>
                  <td>Sales</td>
                  <td style="text-align: right;">-</td>
                  <td style="text-align: right;">1,80,000</td>
                </tr>
                <tr>
                  <td>10</td>
                  <td>Rent Account</td>
                  <td style="text-align: right;">24,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>11</td>
                  <td>Salary Account</td>
                  <td style="text-align: right;">36,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr style="background: rgba(76,175,80,0.15); font-weight: bold;">
                  <td colspan="2" style="text-align: right;">Total:</td>
                  <td style="text-align: right;">4,80,000</td>
                  <td style="text-align: right;">4,20,000</td>
                </tr>
              </tbody>
            </table>
            <span class="table-scroll-hint">← Scroll horizontally →</span>
          </div>

          <div class="note-box" style="margin-top: 15px;">
            <h4>Verification:</h4>
            <p style="margin: 0; font-size: 0.85rem;">
              <strong>Debit Total:</strong> ₹4,80,000<br>
              <strong>Credit Total:</strong> ₹4,20,000<br>
              <strong>Note:</strong> This Trial Balance does NOT tally, indicating an error in the books.
            </p>
          </div>
        </div>
      </div>

      <!-- Question 2 -->
      <div class="practical-card">
        <div class="practical-header">
          <div class="practical-icon">2</div>
          <div>
            <h3 class="practical-title">Question 2: Trading Business</h3>
            <p style="color: var(--muted); margin: 5px 0 0 0; font-size: 0.85rem;">From the following balances, prepare Trial Balance</p>
          </div>
        </div>

        <div style="color: var(--muted); line-height: 1.8; margin: 20px 0; font-size: 0.9rem;">
          <strong>Ledger Balances as on 31st December 2024:</strong>
          <ol style="margin: 10px 0; padding-left: 20px;">
            <li>Cash: ₹25,000</li>
            <li>Bank: ₹1,15,000</li>
            <li>Capital: ₹3,00,000</li>
            <li>Loan from Bank: ₹50,000</li>
            <li>Building: ₹1,50,000</li>
            <li>Machinery: ₹80,000</li>
            <li>Purchases: ₹2,40,000</li>
            <li>Sales: ₹3,50,000</li>
            <li>Wages: ₹45,000</li>
            <li>Salaries: ₹60,000</li>
          </ol>
        </div>

        <button class="view-solution-btn" onclick="toggleSolution('q2', event)">View Solution</button>

        <div class="solution" id="q2-solution">
          <h4 style="color: var(--brand-2); margin-bottom: 15px; font-size: 1rem;">Solution: Trial Balance as on 31st December 2024</h4>
          
          <div class="table-wrapper">
            <table class="trial-balance-table">
              <thead>
                <tr>
                  <th>S.No.</th>
                  <th>Particulars</th>
                  <th>Debit (₹)</th>
                  <th>Credit (₹)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td>Cash Account</td>
                  <td style="text-align: right;">25,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>Bank Account</td>
                  <td style="text-align: right;">1,15,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>3</td>
                  <td>Capital Account</td>
                  <td style="text-align: right;">-</td>
                  <td style="text-align: right;">3,00,000</td>
                </tr>
                <tr>
                  <td>4</td>
                  <td>Loan from Bank</td>
                  <td style="text-align: right;">-</td>
                  <td style="text-align: right;">50,000</td>
                </tr>
                <tr>
                  <td>5</td>
                  <td>Building</td>
                  <td style="text-align: right;">1,50,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>6</td>
                  <td>Machinery</td>
                  <td style="text-align: right;">80,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>7</td>
                  <td>Purchases</td>
                  <td style="text-align: right;">2,40,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>8</td>
                  <td>Sales</td>
                  <td style="text-align: right;">-</td>
                  <td style="text-align: right;">3,50,000</td>
                </tr>
                <tr>
                  <td>9</td>
                  <td>Wages</td>
                  <td style="text-align: right;">45,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>10</td>
                  <td>Salaries</td>
                  <td style="text-align: right;">60,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr style="background: rgba(76,175,80,0.15); font-weight: bold;">
                  <td colspan="2" style="text-align: right;">Total:</td>
                  <td style="text-align: right;">7,15,000</td>
                  <td style="text-align: right;">7,00,000</td>
                </tr>
              </tbody>
            </table>
            <span class="table-scroll-hint">← Scroll horizontally →</span>
          </div>

          <div class="error-box" style="margin-top: 15px;">
            <h4>Analysis:</h4>
            <p style="margin: 0; color: var(--muted); font-size: 0.85rem;">
              <strong>Debit Total:</strong> ₹7,15,000<br>
              <strong>Credit Total:</strong> ₹7,00,000<br>
              <strong>Difference:</strong> ₹15,000 (Debit exceeds Credit)<br>
              This indicates there's an error in the books that needs to be investigated.
            </p>
          </div>
        </div>
      </div>

      <!-- Question 3 -->
      <div class="practical-card">
        <div class="practical-header">
          <div class="practical-icon">3</div>
          <div>
            <h3 class="practical-title">Question 3: Comprehensive Business</h3>
            <p style="color: var(--muted); margin: 5px 0 0 0; font-size: 0.85rem;">Prepare Trial Balance from the following</p>
          </div>
        </div>

        <div style="color: var(--muted); line-height: 1.8; margin: 20px 0; font-size: 0.9rem;">
          <strong>Account Balances as on 31st January 2025:</strong>
          <ol style="margin: 10px 0; padding-left: 20px;">
            <li>Capital: ₹5,00,000</li>
            <li>Drawings: ₹40,000</li>
            <li>Cash: ₹55,000</li>
            <li>Bank: ₹1,95,000</li>
            <li>Purchases: ₹3,20,000</li>
            <li>Sales: ₹4,80,000</li>
            <li>Returns Inward: ₹15,000</li>
            <li>Returns Outward: ₹12,000</li>
            <li>Rent: ₹48,000</li>
            <li>Insurance: ₹18,000</li>
          </ol>
        </div>

        <button class="view-solution-btn" onclick="toggleSolution('q3', event)">View Solution</button>

        <div class="solution" id="q3-solution">
          <h4 style="color: var(--brand-2); margin-bottom: 15px; font-size: 1rem;">Solution: Trial Balance as on 31st January 2025</h4>
          
          <div class="table-wrapper">
            <table class="trial-balance-table">
              <thead>
                <tr>
                  <th>S.No.</th>
                  <th>Particulars</th>
                  <th>Debit (₹)</th>
                  <th>Credit (₹)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td>Capital Account</td>
                  <td style="text-align: right;">-</td>
                  <td style="text-align: right;">5,00,000</td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>Drawings</td>
                  <td style="text-align: right;">40,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>3</td>
                  <td>Cash</td>
                  <td style="text-align: right;">55,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>4</td>
                  <td>Bank</td>
                  <td style="text-align: right;">1,95,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>5</td>
                  <td>Purchases</td>
                  <td style="text-align: right;">3,20,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>6</td>
                  <td>Sales</td>
                  <td style="text-align: right;">-</td>
                  <td style="text-align: right;">4,80,000</td>
                </tr>
                <tr>
                  <td>7</td>
                  <td>Returns Inward</td>
                  <td style="text-align: right;">15,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>8</td>
                  <td>Returns Outward</td>
                  <td style="text-align: right;">-</td>
                  <td style="text-align: right;">12,000</td>
                </tr>
                <tr>
                  <td>9</td>
                  <td>Rent</td>
                  <td style="text-align: right;">48,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr>
                  <td>10</td>
                  <td>Insurance</td>
                  <td style="text-align: right;">18,000</td>
                  <td style="text-align: right;">-</td>
                </tr>
                <tr style="background: rgba(76,175,80,0.15); font-weight: bold;">
                  <td colspan="2" style="text-align: right;">Total:</td>
                  <td style="text-align: right;">6,91,000</td>
                  <td style="text-align: right;">9,92,000</td>
                </tr>
              </tbody>
            </table>
            <span class="table-scroll-hint">← Scroll horizontally →</span>
          </div>

          <div class="error-box" style="margin-top: 15px;">
            <h4>Analysis:</h4>
            <p style="margin: 0; color: var(--muted); font-size: 0.85rem;">
              This Trial Balance shows a significant mismatch. Credits exceed debits by ₹3,01,000. This could indicate missing asset entries or incorrect recording.
            </p>
          </div>
        </div>
      </div>

      <!-- Question 4 - PLACEHOLDER -->
      <div class="practical-card" style="border: 2px dashed rgba(255,255,255,0.2);">
        <div class="practical-header">
          <div class="practical-icon" style="background: rgba(255,255,255,0.1);">4</div>
          <div>
            <h3 class="practical-title" style="color: var(--muted);">Question 4: [Placeholder]</h3>
            <p style="color: var(--muted); margin: 5px 0 0 0; font-size: 0.85rem;">Additional practice question will be added here</p>
          </div>
        </div>
        <p style="text-align: center; color: var(--muted); padding: 30px 10px; font-style: italic;">
          <i class="fas fa-hourglass-half" style="font-size: 2rem; display: block; margin-bottom: 10px; opacity: 0.3;"></i>
          More practice questions coming soon...
        </p>
      </div>

      <!-- Question 5 - PLACEHOLDER -->
      <div class="practical-card" style="border: 2px dashed rgba(255,255,255,0.2);">
        <div class="practical-header">
          <div class="practical-icon" style="background: rgba(255,255,255,0.1);">5</div>
          <div>
            <h3 class="practical-title" style="color: var(--muted);">Question 5: [Placeholder]</h3>
            <p style="color: var(--muted); margin: 5px 0 0 0; font-size: 0.85rem;">Additional practice question will be added here</p>
          </div>
        </div>
        <p style="text-align: center; color: var(--muted); padding: 30px 10px; font-style: italic;">
          <i class="fas fa-hourglass-half" style="font-size: 2rem; display: block; margin-bottom: 10px; opacity: 0.3;"></i>
          More practice questions coming soon...
        </p>
      </div>
    </section>

        <!-- Trial Balance Challenge Game -->
    <section>
      <h2>Trial Balance Challenge Game</h2>
      <p style="margin-bottom: 20px;">
        Drag and drop the amounts into the correct debit or credit columns. Get the Trial Balance to match!
      </p>

      <div class="game-container">
        <div class="transactions-panel">
          <h3>Transactions</h3>
          <div id="transactions-list" class="transactions-list"></div>
        </div>

        <div class="trial-balance-panel">
          <h3>Trial Balance</h3>
          <div class="table-wrapper">
            <table class="game-trial-balance">
              <thead>
                <tr>
                  <th>Account</th>
                  <th>Debit (₹)</th>
                  <th>Credit (₹)</th>
                </tr>
              </thead>
              <tbody id="game-tbody"></tbody>
              <tfoot>
                <tr class="totals-row">
                  <td>Total:</td>
                  <td id="debit-total">0</td>
                  <td id="credit-total">0</td>
                </tr>
              </tfoot>
            </table>
            <span class="table-scroll-hint">← Scroll horizontally →</span>
          </div>

          <div class="game-controls">
            <button class="hint-btn" onclick="showHint()">
              <i class="fas fa-lightbulb"></i> Hint
            </button>
            <button class="reset-btn" onclick="resetGame()">
              <i class="fas fa-redo"></i> Reset
            </button>
            <button class="check-btn" onclick="checkBalance()">
              <i class="fas fa-check"></i> Check Balance
            </button>
          </div>

          <div id="game-feedback" class="game-feedback"></div>
        </div>
      </div>

      <!-- Confetti Canvas -->
      <canvas id="confetti-canvas"></canvas>
    </section>

    <!-- Trial Balance Calculator -->
    <section>
      <h2>Trial Balance Calculator</h2>
      <p style="margin-bottom: 20px;">
        Enter debit and credit amounts to practice balancing. The calculator will validate in real-time.
      </p>

      <div class="calculator-container">
        <div class="calculator-controls">
          <button class="add-row-btn" onclick="addCalculatorRow()">
            <i class="fas fa-plus"></i> Add Account
          </button>
          <button class="clear-all-btn" onclick="clearCalculator()">
            <i class="fas fa-trash"></i> Clear All
          </button>
        </div>

        <div class="table-wrapper">
          <table class="calculator-table">
            <thead>
              <tr>
                <th>Account Name</th>
                <th>Debit (₹)</th>
                <th>Credit (₹)</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="calculator-tbody">
              <tr class="calculator-row">
                <td><input type="text" class="account-name" placeholder="Enter account name"></td>
                <td><input type="number" class="debit-input" placeholder="0"></td>
                <td><input type="number" class="credit-input" placeholder="0"></td>
                <td><button class="remove-row-btn" onclick="removeCalculatorRow(this)"><i class="fas fa-times"></i></button></td>
              </tr>
            </tbody>
            <tfoot>
              <tr class="calculator-totals">
                <td>Total:</td>
                <td id="calc-debit-total">0</td>
                <td id="calc-credit-total">0</td>
                <td></td>
              </tr>
            </tfoot>
          </table>
          <span class="table-scroll-hint">← Scroll horizontally →</span>
        </div>

        <div class="balance-status" id="balance-status">
          <span class="status-text">Enter amounts to check balance</span>
        </div>
      </div>
    </section>

    <!-- MCQs -->
    <section id="mcqSection">
      <h2>🧩 MCQ Practice</h2>
      <div id="quiz-progress"></div>
      <div class="mcq-grid" id="quiz-container">
        <!-- Question 1 -->
        <div class="mcq" data-answer="b">
          <h3>1. A statement prepared to check the arithmetical accuracy of the ledger accounts is called:</h3>
          <input type="radio" name="q1" id="q1a" value="a"><label for="q1a">Balance Sheet</label>
          <input type="radio" name="q1" id="q1b" value="b"><label for="q1b">Trial Balance</label>
          <input type="radio" name="q1" id="q1c" value="c"><label for="q1c">Trading Account</label>
          <input type="radio" name="q1" id="q1d" value="d"><label for="q1d">Profit & Loss Account</label>
        </div>

        <!-- Question 2 -->
        <div class="mcq" data-answer="a">
          <h3>2. The Trial Balance is prepared on the basis of balances taken from:</h3>
          <input type="radio" name="q2" id="q2a" value="a"><label for="q2a">Ledger Accounts</label>
          <input type="radio" name="q2" id="q2b" value="b"><label for="q2b">Journal Entries</label>
          <input type="radio" name="q2" id="q2c" value="c"><label for="q2c">Cash Book</label>
          <input type="radio" name="q2" id="q2d" value="d"><label for="q2d">Balance Sheet</label>
        </div>

        <!-- Question 3 -->
        <div class="mcq" data-answer="d">
          <h3>3. A Trial Balance is usually prepared at the end of:</h3>
          <input type="radio" name="q3" id="q3a" value="a"><label for="q3a">Every day</label>
          <input type="radio" name="q3" id="q3b" value="b"><label for="q3b">Every week</label>
          <input type="radio" name="q3" id="q3c" value="c"><label for="q3c">Every quarter</label>
          <input type="radio" name="q3" id="q3d" value="d"><label for="q3d">An accounting year</label>
        </div>

        <!-- Question 4 -->
        <div class="mcq" data-answer="c">
          <h3>4. If the Trial Balance does not agree, the difference is transferred to:</h3>
          <input type="radio" name="q4" id="q4a" value="a"><label for="q4a">Profit & Loss Account</label>
          <input type="radio" name="q4" id="q4b" value="b"><label for="q4b">Balance Sheet</label>
          <input type="radio" name="q4" id="q4c" value="c"><label for="q4c">Suspense Account</label>
          <input type="radio" name="q4" id="q4d" value="d"><label for="q4d">Capital Account</label>
        </div>

        <!-- Question 5 -->
        <div class="mcq" data-answer="b">
          <h3>5. Errors that do not affect the agreement of the Trial Balance are called:</h3>
          <input type="radio" name="q5" id="q5a" value="a"><label for="q5a">One-sided errors</label>
          <input type="radio" name="q5" id="q5b" value="b"><label for="q5b">Two-sided errors</label>
          <input type="radio" name="q5" id="q5c" value="c"><label for="q5c">Compensating errors</label>
          <input type="radio" name="q5" id="q5d" value="d"><label for="q5d">Clerical errors</label>
        </div>

        <!-- Question 6 -->
        <div class="mcq" data-answer="a">
          <h3>6. Errors of principle occur when:</h3>
          <input type="radio" name="q6" id="q6a" value="a"><label for="q6a">A transaction is recorded in the wrong class of account</label>
          <input type="radio" name="q6" id="q6b" value="b"><label for="q6b">An amount is wrongly posted</label>
          <input type="radio" name="q6" id="q6c" value="c"><label for="q6c">Entries are omitted</label>
          <input type="radio" name="q6" id="q6d" value="d"><label for="q6d">Entries are posted twice</label>
        </div>

        <!-- Question 7 -->
        <div class="mcq" data-answer="d">
          <h3>7. Which of the following errors will not affect the Trial Balance?</h3>
          <input type="radio" name="q7" id="q7a" value="a"><label for="q7a">Wrong casting of Sales Book</label>
          <input type="radio" name="q7" id="q7b" value="b"><label for="q7b">Posting an amount to the wrong side</label>
          <input type="radio" name="q7" id="q7c" value="c"><label for="q7c">Wrong totaling of ledger account</label>
          <input type="radio" name="q7" id="q7d" value="d"><label for="q7d">Errors of principle</label>
        </div>

        <!-- Question 8 -->
        <div class="mcq" data-answer="b">
          <h3>8. Error of omission occurs when:</h3>
          <input type="radio" name="q8" id="q8a" value="a"><label for="q8a">A transaction is recorded twice</label>
          <input type="radio" name="q8" id="q8b" value="b"><label for="q8b">A transaction is completely left out</label>
          <input type="radio" name="q8" id="q8c" value="c"><label for="q8c">An incorrect amount is posted</label>
          <input type="radio" name="q8" id="q8d" value="d"><label for="q8d">An expense is treated as an asset</label>
        </div>

        <!-- Question 9 -->
        <div class="mcq" data-answer="a">
          <h3>9. Trial Balance helps in locating:</h3>
          <input type="radio" name="q9" id="q9a" value="a"><label for="q9a">One-sided errors</label>
          <input type="radio" name="q9" id="q9b" value="b"><label for="q9b">Errors of principle</label>
          <input type="radio" name="q9" id="q9c" value="c"><label for="q9c">Errors of omission</label>
          <input type="radio" name="q9" id="q9d" value="d"><label for="q9d">Compensating errors</label>
        </div>

        <!-- Question 10 -->
        <div class="mcq" data-answer="c">
          <h3>10. Errors of commission are caused by:</h3>
          <input type="radio" name="q10" id="q10a" value="a"><label for="q10a">Recording in wrong class of account</label>
          <input type="radio" name="q10" id="q10b" value="b"><label for="q10b">Omitting a transaction</label>
          <input type="radio" name="q10" id="q10c" value="c"><label for="q10c">Wrong posting or totaling</label>
          <input type="radio" name="q10" id="q10d" value="d"><label for="q10d">Omitting subsidiary book entry</label>
        </div>

        <!-- Question 11 -->
        <div class="mcq" data-answer="d">
          <h3>11. The difference in Trial Balance due to one-sided errors is placed in:</h3>
          <input type="radio" name="q11" id="q11a" value="a"><label for="q11a">Capital Account</label>
          <input type="radio" name="q11" id="q11b" value="b"><label for="q11b">Cash Account</label>
          <input type="radio" name="q11" id="q11c" value="c"><label for="q11c">Purchase Account</label>
          <input type="radio" name="q11" id="q11d" value="d"><label for="q11d">Suspense Account</label>
        </div>

        <!-- Question 12 -->
        <div class="mcq" data-answer="a">
          <h3>12. Compensating errors are those which:</h3>
          <input type="radio" name="q12" id="q12a" value="a"><label for="q12a">Cancel each other's effect</label>
          <input type="radio" name="q12" id="q12b" value="b"><label for="q12b">Affect both sides equally</label>
          <input type="radio" name="q12" id="q12c" value="c"><label for="q12c">Affect only debit side</label>
          <input type="radio" name="q12" id="q12d" value="d"><label for="q12d">Affect only credit side</label>
        </div>

        <!-- Question 13 -->
        <div class="mcq" data-answer="b">
          <h3>13. Error in recording a transaction in the wrong subsidiary book is an example of:</h3>
          <input type="radio" name="q13" id="q13a" value="a"><label for="q13a">Error of omission</label>
          <input type="radio" name="q13" id="q13b" value="b"><label for="q13b">Error of commission</label>
          <input type="radio" name="q13" id="q13c" value="c"><label for="q13c">Error of principle</label>
          <input type="radio" name="q13" id="q13d" value="d"><label for="q13d">Compensating error</label>
        </div>

        <!-- Question 14 -->
        <div class="mcq" data-answer="c">
          <h3>14. Posting ₹500 on the wrong side of an account is an example of:</h3>
          <input type="radio" name="q14" id="q14a" value="a"><label for="q14a">Error of principle</label>
          <input type="radio" name="q14" id="q14b" value="b"><label for="q14b">Error of omission</label>
          <input type="radio" name="q14" id="q14c" value="c"><label for="q14c">Error of commission</label>
          <input type="radio" name="q14" id="q14d" value="d"><label for="q14d">Error of duplication</label>
        </div>

        <!-- Question 15 -->
        <div class="mcq" data-answer="a">
          <h3>15. If both aspects of a transaction are omitted, it is called:</h3>
          <input type="radio" name="q15" id="q15a" value="a"><label for="q15a">Complete omission</label>
          <input type="radio" name="q15" id="q15b" value="b"><label for="q15b">Partial omission</label>
          <input type="radio" name="q15" id="q15c" value="c"><label for="q15c">Error of principle</label>
          <input type="radio" name="q15" id="q15d" value="d"><label for="q15d">Error of commission</label>
        </div>

        <!-- Question 16 -->
        <div class="mcq" data-answer="d">
          <h3>16. When the debit and credit totals of the Trial Balance are equal, it proves that:</h3>
          <input type="radio" name="q16" id="q16a" value="a"><label for="q16a">No errors exist</label>
          <input type="radio" name="q16" id="q16b" value="b"><label for="q16b">Only arithmetical accuracy is checked</label>
          <input type="radio" name="q16" id="q16c" value="c"><label for="q16c">All ledger accounts are correct</label>
          <input type="radio" name="q16" id="q16d" value="d"><label for="q16d">Arithmetical accuracy is proved</label>
        </div>

        <!-- Question 17 -->
        <div class="mcq" data-answer="b">
          <h3>17. An error where ₹500 received from Ramesh is credited to Suresh is called:</h3>
          <input type="radio" name="q17" id="q17a" value="a"><label for="q17a">Error of principle</label>
          <input type="radio" name="q17" id="q17b" value="b"><label for="q17b">Error of commission</label>
          <input type="radio" name="q17" id="q17c" value="c"><label for="q17c">Error of omission</label>
          <input type="radio" name="q17" id="q17d" value="d"><label for="q17d">Error of original entry</label>
        </div>

        <!-- Question 18 -->
        <div class="mcq" data-answer="a">
          <h3>18. Which one of the following errors affects the agreement of the Trial Balance?</h3>
          <input type="radio" name="q18" id="q18a" value="a"><label for="q18a">Posting to wrong side of an account</label>
          <input type="radio" name="q18" id="q18b" value="b"><label for="q18b">Error of principle</label>
          <input type="radio" name="q18" id="q18c" value="c"><label for="q18c">Compensating error</label>
          <input type="radio" name="q18" id="q18d" value="d"><label for="q18d">Omission of both aspects</label>
        </div>

        <!-- Question 19 -->
        <div class="mcq" data-answer="d">
          <h3>19. Suspense Account is closed when:</h3>
          <input type="radio" name="q19" id="q19a" value="a"><label for="q19a">All accounts are opened</label>
          <input type="radio" name="q19" id="q19b" value="b"><label for="q19b">Trial Balance is prepared</label>
          <input type="radio" name="q19" id="q19c" value="c"><label for="q19c">Errors are detected and rectified</label>
          <input type="radio" name="q19" id="q19d" value="d"><label for="q19d">Errors are rectified</label>
        </div>

        <!-- Question 20 -->
        <div class="mcq" data-answer="c">
          <h3>20. Which of the following is not detected by a Trial Balance?</h3>
          <input type="radio" name="q20" id="q20a" value="a"><label for="q20a">Error of casting</label>
          <input type="radio" name="q20" id="q20b" value="b"><label for="q20b">Posting to wrong side</label>
          <input type="radio" name="q20" id="q20c" value="c"><label for="q20c">Error of principle</label>
          <input type="radio" name="q20" id="q20d" value="d"><label for="q20d">Wrong balancing of account</label>
        </div>
      </div>

      <button id="submitQuiz" onclick="submitQuiz()">Submit Answers</button>
      <div id="quizResult"></div>
      <button id="retry-btn" onclick="retryQuiz()" style="display:none;">Try Again</button>
    </section>

  </main>

    <!-- JavaScript for All Interactive Features -->
  <script type="module">
    // ========================================
    // 1. IMPORT FIREBASE
    // ========================================
    import { submitLessonAttempt, loadPreviousAnswers } from '../firebase-config.js';

    // ========================================
    // 2. CONFIGURATION
    // ========================================
    const LESSON_NUMBER = '14';
    const LESSON_ID = 'lesson-14';

    // ========================================
    // 3. QUIZ SYSTEM
    // ========================================
    function initQuiz() {
      console.log('🎯 Initializing quiz for Lesson', LESSON_NUMBER);
      
      const container = document.getElementById('quiz-container');
      if (!container) {
        console.error('❌ Quiz container not found');
        return;
      }

      const allInputs = container.querySelectorAll('input[type="radio"]');
      allInputs.forEach(input => {
        input.addEventListener('click', function(e) {
          if (this.dataset.checked === 'true') {
            this.checked = false;
            this.dataset.checked = 'false';
          } else {
            const groupName = this.name;
            document.querySelectorAll(`input[name="${groupName}"]`).forEach(radio => {
              radio.dataset.checked = 'false';
            });
            this.dataset.checked = 'true';
          }
        });
      });

      console.log('✅ Quiz initialized with', allInputs.length, 'options');
    }

    // ========================================
    // 4. SUBMIT QUIZ
    // ========================================
    window.submitQuiz = async function() {
      console.log('📤 Submitting quiz for Lesson', LESSON_NUMBER);
      
      const container = document.getElementById('quiz-container');
      if (!container) return;

      const mcqs = container.querySelectorAll('.mcq');
      if (mcqs.length === 0) return;

      let answersData = {};
      let correctCount = 0;
      let totalQuestions = mcqs.length;
      let answeredCount = 0;

      mcqs.forEach((mcq, index) => {
        const correctAnswer = mcq.dataset.answer;
        const questionNumber = `q${index + 1}`;
        const inputs = mcq.querySelectorAll('input[type="radio"]');
        const questionName = inputs[0].name;
        const selected = document.querySelector(`input[name="${questionName}"]:checked`);

        if (!selected) return;

        answeredCount++;
        const selectedValue = selected.value;
        const isCorrect = selectedValue === correctAnswer;
        if (isCorrect) correctCount++;

        answersData[questionNumber] = {
          selected: selectedValue,
          correct: correctAnswer,
          isCorrect: isCorrect
        };

        inputs.forEach(input => {
          const label = input.nextElementSibling;
          if (!label) return;
          input.disabled = true;
          if (input.value === correctAnswer) {
            label.style.background = 'linear-gradient(90deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1))';
            label.style.borderLeft = '4px solid #10b981';
            label.style.fontWeight = 'bold';
          }
          if (input.value === selectedValue && !isCorrect) {
            label.style.background = 'linear-gradient(90deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1))';
            label.style.borderLeft = '4px solid #ef4444';
          }
        });
      });

      if (answeredCount === 0) {
        alert('⚠️ Please answer at least 1 question before submitting!');
        return;
      }

      const percentage = Math.round((correctCount / totalQuestions) * 100);
      const submitBtn = document.getElementById('submitQuiz');
      const resultDiv = document.getElementById('quizResult');

      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';
      }

      if (resultDiv) {
        resultDiv.innerHTML = `
          <div style="padding: 20px; margin-top: 20px; background: rgba(124,77,255,0.1); border-radius: 12px; text-align: center;">
            <div style="font-size: 1.2rem; color: var(--brand-2);">⚙️ Saving your progress...</div>
          </div>`;
      }

      try {
        console.log("📤 Submitting to Firebase:", { lessonNumber: LESSON_NUMBER, correctCount, totalQuestions, percentage });
        const result = await submitLessonAttempt(LESSON_NUMBER, answersData, correctCount, totalQuestions);
        console.log("✅ Firebase response:", result);

        if (resultDiv) {
          if (result && result.success) {
            if (result.updated) {
              resultDiv.innerHTML = `
                <div style="padding: 20px; margin-top: 20px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1)); border-radius: 12px; border: 2px solid #10b981;">
                  <div style="font-size: 1.5rem; font-weight: bold; color: #10b981; margin-bottom: 10px;">🎉 New Best Score!</div>
                  <div style="font-size: 1.2rem; margin-bottom: 10px;">You scored: <strong>${correctCount}/${totalQuestions}</strong> (${percentage}%)</div>
                  <div style="color: var(--muted); font-size: 0.9rem;">✅ Answered ${answeredCount} out of ${totalQuestions} questions</div>
                  <div style="color: var(--muted); font-size: 0.85rem; margin-top: 10px;">✅ Progress saved to cloud</div>
                </div>`;
            } else {
              resultDiv.innerHTML = `
                <div style="padding: 20px; margin-top: 20px; background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(251, 191, 36, 0.1)); border-radius: 12px; border: 2px solid #fbbf24;">
                  <div style="font-size: 1.5rem; font-weight: bold; color: #fbbf24; margin-bottom: 10px;">📊 Quiz Completed</div>
                  <div style="font-size: 1.2rem; margin-bottom: 10px;">Current Score: <strong>${correctCount}/${totalQuestions}</strong> (${percentage}%)</div>
                  <div style="font-size: 1.1rem; margin-bottom: 10px; color: #10b981;">Your Best: <strong>${result.bestScore}/${result.totalQuestions}</strong> (${result.percentage}%)</div>
                  <div style="color: var(--muted); font-size: 0.9rem;">Answered ${answeredCount} out of ${totalQuestions} questions</div>
                  <div style="color: var(--muted); font-size: 0.85rem; margin-top: 10px;">💡 Try again to beat your best score!</div>
                </div>`;
            }
          } else {
            resultDiv.innerHTML = `
              <div style="padding: 20px; margin-top: 20px; background: linear-gradient(135deg, rgba(124,77,255,0.2), rgba(124,77,255,0.1)); border-radius: 12px; border: 2px solid var(--brand);">
                <div style="font-size: 1.5rem; font-weight: bold; color: var(--brand-2); margin-bottom: 10px;">📊 Your Score</div>
                <div style="font-size: 1.2rem; margin-bottom: 10px;">You scored: <strong>${correctCount}/${totalQuestions}</strong> (${percentage}%)</div>
                <div style="color: var(--muted); font-size: 0.9rem;">✅ Answered ${answeredCount} out of ${totalQuestions} questions</div>
                <div style="color: #fbbf24; font-size: 0.85rem; margin-top: 10px;">⚠️ Could not save to cloud. Check console (F12) for details.</div>
              </div>`;
            console.error("❌ Firebase error:", result?.error || "Unknown error");
          }
        }
      } catch (error) {
        console.error("❌ Critical error during submission:", error);
        if (resultDiv) {
          resultDiv.innerHTML = `
            <div style="padding: 20px; margin-top: 20px; background: linear-gradient(135deg, rgba(124,77,255,0.2), rgba(124,77,255,0.1)); border-radius: 12px; border: 2px solid var(--brand);">
              <div style="font-size: 1.5rem; font-weight: bold; color: var(--brand-2); margin-bottom: 10px;">📊 Your Score</div>
              <div style="font-size: 1.2rem; margin-bottom: 10px;">You scored: <strong>${correctCount}/${totalQuestions}</strong> (${percentage}%)</div>
              <div style="color: var(--muted); font-size: 0.9rem;">✅ Answered ${answeredCount} out of ${totalQuestions} questions</div>
              <div style="color: #ef4444; font-size: 0.85rem; margin-top: 10px;">❌ Error: ${error.message}</div>
            </div>`;
        }
      } finally {
        const retryBtn = document.getElementById('retry-btn');
        if (retryBtn) retryBtn.style.display = 'block';
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.textContent = '✓ Submitted';
        }
      }
    };

    // ========================================
    // 5. RETRY QUIZ
    // ========================================
    window.retryQuiz = function() {
      console.log('🔄 Retrying quiz');
      
      const container = document.getElementById('quiz-container');
      if (!container) return;

      const allInputs = container.querySelectorAll('input[type="radio"]');
      allInputs.forEach(input => {
        input.checked = false;
        input.disabled = false;
        input.dataset.checked = 'false';
        
        const label = input.nextElementSibling;
        if (label) {
          label.style.background = '';
          label.style.borderLeft = '';
          label.style.fontWeight = '';
        }
      });

      const resultDiv = document.getElementById('quizResult');
      if (resultDiv) resultDiv.innerHTML = '';

      const submitBtn = document.getElementById('submitQuiz');
      if (submitBtn) {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Answers';
      }

      const retryBtn = document.getElementById('retry-btn');
      if (retryBtn) retryBtn.style.display = 'none';

      document.getElementById('mcqSection')?.scrollIntoView({ behavior: 'smooth' });
    };

    // ========================================
    // 6. TOGGLE SOLUTION FUNCTION
    // ========================================
    window.toggleSolution = function(id, event) {
      const solution = document.getElementById(id + '-solution');
      const button = event.currentTarget;

      if (!solution || !button) {
        console.error('Solution or button not found for id:', id);
        return;
      }
      
      if (solution.classList.contains('active')) {
        solution.classList.remove('active');
        button.textContent = 'View Solution';
      } else {
        solution.classList.add('active');
        button.textContent = 'Hide Solution';
      }
    }

    // ========================================
    // 7. GAME DATA & INITIALIZATION
    // ========================================
    const gameTransactions = [
      { id: 1, account: "Cash", amount: 50000, type: "debit" },
      { id: 2, account: "Capital", amount: 200000, type: "credit" },
      { id: 3, account: "Furniture", amount: 45000, type: "debit" },
      { id: 4, account: "Bank Loan", amount: 80000, type: "credit" },
      { id: 5, account: "Purchases", amount: 120000, type: "debit" },
      { id: 6, account: "Sales", amount: 180000, type: "credit" },
      { id: 7, account: "Rent Expense", amount: 24000, type: "debit" },
      { id: 8, account: "Debtors", amount: 65000, type: "debit" },
      { id: 9, account: "Creditors", amount: 55000, type: "credit" },
      { id: 10, account: "Salary Expense", amount: 36000, type: "debit" },
      { id: 11, account: "Commission Income", amount: 15000, type: "credit" },
      { id: 12, account: "Insurance", amount: 18000, type: "debit" }
    ];

    let currentGameState = {
      placedItems: {},
      attempts: 0,
      hintsUsed: 0,
      startTime: Date.now()
    };

    window.initializeGame = function() {
      const savedProgress = localStorage.getItem('trialBalanceGameProgress');
      if (savedProgress) {
        currentGameState = JSON.parse(savedProgress);
      }

      const transactionsList = document.getElementById('transactions-list');
      if (!transactionsList) return;
      
      transactionsList.innerHTML = '';
      
      gameTransactions.forEach(transaction => {
        const item = document.createElement('div');
        item.className = 'transaction-item';
        item.draggable = true;
        item.dataset.id = transaction.id;
        item.dataset.amount = transaction.amount;
        item.dataset.type = transaction.type;
        item.innerHTML = `
          <div class="transaction-amount">₹${transaction.amount.toLocaleString()}</div>
          <div class="transaction-account">${transaction.account}</div>
        `;
        
        item.addEventListener('dragstart', handleDragStart);
        item.addEventListener('dragend', handleDragEnd);
        
        // Touch support for mobile
        item.addEventListener('touchstart', handleTouchStart, { passive: false });
        item.addEventListener('touchmove', handleTouchMove, { passive: false });
        item.addEventListener('touchend', handleTouchEnd);
        
        transactionsList.appendChild(item);
      });

      const tbody = document.getElementById('game-tbody');
      if (!tbody) return;
      
      tbody.innerHTML = '';
      
      const accounts = [...new Set(gameTransactions.map(t => t.account))];
      
      accounts.forEach(account => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${account}</td>
          <td><div class="drop-zone" data-column="debit" data-account="${account}">Drop here</div></td>
          <td><div class="drop-zone" data-column="credit" data-account="${account}">Drop here</div></td>
        `;
        tbody.appendChild(row);
      });

      document.querySelectorAll('.drop-zone').forEach(zone => {
        zone.addEventListener('dragover', handleDragOver);
        zone.addEventListener('drop', handleDrop);
        zone.addEventListener('dragleave', handleDragLeave);
        
        // Touch support
        zone.addEventListener('touchenter', handleTouchEnter);
      });

      updateTotals();
    }

    // Drag and Drop Handlers
    let draggedElement = null;

    function handleDragStart(e) {
      draggedElement = e.target;
      e.target.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/plain', e.target.dataset.id);
    }

    function handleDragEnd(e) {
      e.target.classList.remove('dragging');
      draggedElement = null;
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      e.target.classList.add('drag-over');
    }

    function handleDragLeave(e) {
      e.target.classList.remove('drag-over');
    }

    function handleDrop(e) {
      e.preventDefault();
      e.stopPropagation();
      e.target.classList.remove('drag-over');
      
      const draggingItem = document.querySelector('.dragging') || draggedElement;
      if (!draggingItem) return;
      
      const id = draggingItem.dataset.id;
      const amount = parseInt(draggingItem.dataset.amount);
      const dropColumn = e.target.dataset.column;
      const account = e.target.dataset.account;
      
      const transaction = gameTransactions.find(t => t.id == id);
      if (transaction && transaction.account === account && transaction.type === dropColumn) {
        e.target.textContent = `₹${amount.toLocaleString()}`;
        e.target.classList.add('has-value');
        
        currentGameState.placedItems[id] = { account, column: dropColumn, amount };
        draggingItem.style.display = 'none';
        
        updateTotals();
        saveProgress();
      } else {
        e.target.classList.add('incorrect');
        setTimeout(() => e.target.classList.remove('incorrect'), 500);
        showFeedback('Incorrect placement! Check the account type.', 'error');
      }
    }

    // Touch Support for Mobile
    let touchedElement = null;
    let touchStartPos = { x: 0, y: 0 };

    function handleTouchStart(e) {
      touchedElement = e.target.closest('.transaction-item');
      if (!touchedElement) return;
      
      const touch = e.touches[0];
      touchStartPos = { x: touch.clientX, y: touch.clientY };
      touchedElement.classList.add('dragging');
    }

    function handleTouchMove(e) {
      if (!touchedElement) return;
      e.preventDefault();
    }

    function handleTouchEnd(e) {
      if (!touchedElement) return;
      
      const touch = e.changedTouches[0];
      const dropTarget = document.elementFromPoint(touch.clientX, touch.clientY);
      const dropZone = dropTarget?.closest('.drop-zone');
      
      if (dropZone) {
        const id = touchedElement.dataset.id;
        const amount = parseInt(touchedElement.dataset.amount);
        const dropColumn = dropZone.dataset.column;
        const account = dropZone.dataset.account;
        
        const transaction = gameTransactions.find(t => t.id == id);
        if (transaction && transaction.account === account && transaction.type === dropColumn) {
          dropZone.textContent = `₹${amount.toLocaleString()}`;
          dropZone.classList.add('has-value');
          
          currentGameState.placedItems[id] = { account, column: dropColumn, amount };
          touchedElement.style.display = 'none';
          
          updateTotals();
          saveProgress();
        } else {
          dropZone.classList.add('incorrect');
          setTimeout(() => dropZone.classList.remove('incorrect'), 500);
          showFeedback('Incorrect placement!', 'error');
        }
      }
      
      touchedElement.classList.remove('dragging');
      touchedElement = null;
    }

    function handleTouchEnter(e) {
      // Visual feedback for touch
    }

    function updateTotals() {
      let debitTotal = 0;
      let creditTotal = 0;
      
      document.querySelectorAll('.drop-zone.has-value').forEach(zone => {
        const amount = parseInt(zone.textContent.replace('₹', '').replace(/,/g, ''));
        if (zone.dataset.column === 'debit') {
          debitTotal += amount;
        } else {
          creditTotal += amount;
        }
      });
      
      const debitTotalEl = document.getElementById('debit-total');
      const creditTotalEl = document.getElementById('credit-total');
      
      if (debitTotalEl) debitTotalEl.textContent = `₹${debitTotal.toLocaleString()}`;
      if (creditTotalEl) creditTotalEl.textContent = `₹${creditTotal.toLocaleString()}`;
      
      return { debitTotal, creditTotal };
    }

    window.checkBalance = function() {
      currentGameState.attempts++;
      const { debitTotal, creditTotal } = updateTotals();
      
      if (debitTotal === creditTotal && debitTotal > 0 && Object.keys(currentGameState.placedItems).length === gameTransactions.length) {
        showFeedback('🎉 Congratulations! Trial Balance is Correct!', 'success');
        celebrateSuccess();
        
        const completionData = {
          completed: true,
          attempts: currentGameState.attempts,
          hintsUsed: currentGameState.hintsUsed,
          timeTaken: Date.now() - currentGameState.startTime,
          score: calculateScore()
        };
        
        localStorage.setItem('trialBalanceGameCompleted', JSON.stringify(completionData));
      } else if (debitTotal !== creditTotal) {
        showFeedback(`Not balanced! Debit: ₹${debitTotal.toLocaleString()} | Credit: ₹${creditTotal.toLocaleString()}`, 'error');
      } else {
        showFeedback('Totals are balanced, but some items are missing!', 'hint');
      }
      
      saveProgress();
    }

    window.showHint = function() {
      currentGameState.hintsUsed++;
      
      const unplaced = gameTransactions.filter(t => !currentGameState.placedItems[t.id]);
      
      if (unplaced.length > 0) {
        const hintTransaction = unplaced[0];
        showFeedback(`Hint: The '${hintTransaction.account}' account has a ${hintTransaction.type} balance.`, 'hint');
      } else {
        const { debitTotal, creditTotal } = updateTotals();
        const difference = Math.abs(debitTotal - creditTotal);
        showFeedback(`Hint: Your totals differ by ₹${difference.toLocaleString()}. Check if all amounts are in the correct columns.`, 'hint');
      }
      
      saveProgress();
    }

    window.resetGame = function() {
      if (confirm('Are you sure you want to reset the game?')) {
        currentGameState = { placedItems: {}, attempts: 0, hintsUsed: 0, startTime: Date.now() };
        localStorage.removeItem('trialBalanceGameProgress');
        initializeGame();
        showFeedback('Game reset. Try again!', 'hint');
      }
    }

    function showFeedback(message, type) {
      const feedback = document.getElementById('game-feedback');
      if (!feedback) return;
      
      feedback.textContent = message;
      feedback.className = `game-feedback ${type}`;
      feedback.style.display = 'block';
      setTimeout(() => feedback.style.display = 'none', 5000);
    }

    function celebrateSuccess() {
      const canvas = document.getElementById('confetti-canvas');
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      
      const confetti = [];
      const colors = ['#7c4dff', '#00e5ff', '#ff7ac6', '#4caf50', '#ff9800'];
      
      for (let i = 0; i < 100; i++) {
        confetti.push({
          x: Math.random() * canvas.width,
          y: -10,
          vx: Math.random() * 4 - 2,
          vy: Math.random() * 5 + 3,
          color: colors[Math.floor(Math.random() * colors.length)],
          size: Math.random() * 6 + 3,
          rotation: Math.random() * 360,
          rotationSpeed: Math.random() * 10 - 5
        });
      }
      
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        confetti.forEach((p, i) => {
          p.x += p.vx;
          p.y += p.vy;
          p.rotation += p.rotationSpeed;
          
          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.rotation * Math.PI / 180);
          ctx.fillStyle = p.color;
          ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
          ctx.restore();
          
          if (p.y > canvas.height) confetti.splice(i, 1);
        });
        
        if (confetti.length > 0) requestAnimationFrame(animate);
        else {
          canvas.width = 0;
          canvas.height = 0;
        }
      }
      animate();
    }

    function calculateScore() {
      const baseScore = 100;
      const attemptPenalty = (currentGameState.attempts - 1) * 5;
      const hintPenalty = currentGameState.hintsUsed * 10;
      const timePenalty = Math.floor((Date.now() - currentGameState.startTime) / 60000);
      return Math.max(0, baseScore - attemptPenalty - hintPenalty - timePenalty);
    }

    function saveProgress() {
      localStorage.setItem('trialBalanceGameProgress', JSON.stringify(currentGameState));
    }

    // ========================================
    // 8. CALCULATOR FUNCTIONS
    // ========================================
    window.addCalculatorRow = function() {
      const tbody = document.getElementById('calculator-tbody');
      if (!tbody) return;
      
      const newRow = document.createElement('tr');
      newRow.className = 'calculator-row';
      newRow.innerHTML = `
        <td><input type="text" class="account-name" placeholder="Enter account name"></td>
        <td><input type="number" class="debit-input" placeholder="0"></td>
        <td><input type="number" class="credit-input" placeholder="0"></td>
        <td><button class="remove-row-btn" onclick="removeCalculatorRow(this)"><i class="fas fa-times"></i></button></td>
      `;
      tbody.appendChild(newRow);
      
      newRow.querySelectorAll('.debit-input, .credit-input').forEach(input => {
        input.addEventListener('input', updateCalculatorTotals);
      });
    }

    window.removeCalculatorRow = function(button) {
      button.closest('tr').remove();
      updateCalculatorTotals();
    }

    window.clearCalculator = function() {
      if (confirm('Clear all entries?')) {
        const tbody = document.getElementById('calculator-tbody');
        if (tbody) {
          tbody.innerHTML = '';
          addCalculatorRow();
          updateCalculatorTotals();
        }
      }
    }

    function updateCalculatorTotals() {
      let debitTotal = 0;
      let creditTotal = 0;
      
      document.querySelectorAll('.debit-input').forEach(input => {
        debitTotal += parseFloat(input.value) || 0;
      });
      
      document.querySelectorAll('.credit-input').forEach(input => {
        creditTotal += parseFloat(input.value) || 0;
      });
      
      const debitTotalEl = document.getElementById('calc-debit-total');
      const creditTotalEl = document.getElementById('calc-credit-total');
      
      if (debitTotalEl) debitTotalEl.textContent = `₹${debitTotal.toLocaleString()}`;
      if (creditTotalEl) creditTotalEl.textContent = `₹${creditTotal.toLocaleString()}`;
      
      const statusDiv = document.getElementById('balance-status');
      const statusText = statusDiv?.querySelector('.status-text');
      
      if (!statusDiv || !statusText) return;
      
      if (debitTotal === 0 && creditTotal === 0) {
        statusDiv.className = 'balance-status';
        statusText.innerHTML = 'Enter amounts to check balance';
      } else if (debitTotal === creditTotal) {
        statusDiv.className = 'balance-status balanced';
        statusText.innerHTML = '<i class="fas fa-check-circle"></i> Balanced ✅';
      } else {
        statusDiv.className = 'balance-status not-balanced';
        const difference = Math.abs(debitTotal - creditTotal);
        const higherSide = debitTotal > creditTotal ? 'Debit' : 'Credit';
        statusText.innerHTML = `<i class="fas fa-times-circle"></i> Not Balanced ❌<br><small>${higherSide} exceeds by ₹${difference.toLocaleString()}</small>`;
      }
    }

    // ========================================
    // 9. INITIALIZATION
    // ========================================
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize Quiz
      initQuiz();
      
      // Initialize Game if element exists
      if (document.getElementById('transactions-list')) {
        initializeGame();
      }
      
      // Initialize Calculator listeners
      document.querySelectorAll('.debit-input, .credit-input').forEach(input => {
        input.addEventListener('input', updateCalculatorTotals);
      });
      
      console.log('✅ Lesson', LESSON_NUMBER, 'fully initialized!');
    });

  </script>
</body>
</html>